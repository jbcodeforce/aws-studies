<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>Messaging - AWS Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#integration-and-middleware-sqs-sns class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AWS Studies" class="md-header__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AWS Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Messaging </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/aws-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AWS Studies" class="md-nav__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> AWS Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/aws-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Infrastructure <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Infrastructure data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> EC2-others </a> </li> <li class=md-nav__item> <a href=../networking/ class=md-nav__link> Network </a> </li> <li class=md-nav__item> <a href=../security/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../storage/ class=md-nav__link> S3-Storage </a> </li> <li class=md-nav__item> <a href=../route53/ class=md-nav__link> Route 53 </a> </li> <li class=md-nav__item> <a href=../../monitoring/monitoring/ class=md-nav__link> Monitoring </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Messaging <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Messaging </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#sqs-standard-queue class=md-nav__link> SQS: Standard queue </a> <nav class=md-nav aria-label="SQS: Standard queue"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fan-out-pattern class=md-nav__link> Fan-out pattern </a> </li> <li class=md-nav__item> <a href=#visibility-timeout class=md-nav__link> Visibility timeout </a> </li> <li class=md-nav__item> <a href=#dead-letter-queue class=md-nav__link> Dead Letter Queue </a> </li> <li class=md-nav__item> <a href=#fifo-queue class=md-nav__link> FIFO Queue </a> </li> <li class=md-nav__item> <a href=#security class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=#sample-code class=md-nav__link> Sample Code </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sns-simple-notification-service class=md-nav__link> SNS - Simple Notification Service </a> <nav class=md-nav aria-label="SNS - Simple Notification Service"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#combining-with-sqs-fan-out-pattern class=md-nav__link> Combining with SQS - Fan Out pattern </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#kinesis class=md-nav__link> Kinesis </a> </li> <li class=md-nav__item> <a href=#amazon-mq class=md-nav__link> Amazon MQ </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../kinesis/ class=md-nav__link> Kinesis* </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Architecture <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Architecture data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sa/well-architectured/ class=md-nav__link> Well Architectured </a> </li> <li class=md-nav__item> <a href=../../sa/sol-design/ class=md-nav__link> Solution design </a> </li> <li class=md-nav__item> <a href=../../sa/psa-role/ class=md-nav__link> SA </a> </li> <li class=md-nav__item> <a href=../../sa/saas/ class=md-nav__link> SaaS </a> </li> <li class=md-nav__item> <a href=../../sa/resilience/ class=md-nav__link> Resilience </a> </li> <li class=md-nav__item> <a href=../../templ/ class=md-nav__link> Conduct Design session </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../analytics/ class=md-nav__link> Analytics </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Data <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Data data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/ class=md-nav__link> RDS-Aurora-ES </a> </li> <li class=md-nav__item> <a href=../../data/dynamodb/ class=md-nav__link> DynamoDB </a> </li> <li class=md-nav__item> <a href=../../data/data-lake/ class=md-nav__link> Data Lake </a> </li> <li class=md-nav__item> <a href=../../data/redshift/ class=md-nav__link> RedShift </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../ai-ml/ class=md-nav__link> AI-ML </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Serverless <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Serverless data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Serverless </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serverless/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../serverless/lambda/ class=md-nav__link> Lambda </a> </li> <li class=md-nav__item> <a href=../../serverless/apigtw/ class=md-nav__link> API Gateway </a> </li> <li class=md-nav__item> <a href=../../serverless/eks/ class=md-nav__link> EKS </a> </li> <li class=md-nav__item> <a href=../../serverless/eventbridge/ class=md-nav__link> EventBridge </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Playground <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Playground data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Playground </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../playground/gettingstarted/ class=md-nav__link> Getting Started IAM-EC2 </a> </li> <li class=md-nav__item> <a href=../../playground/rds/ class=md-nav__link> RDS </a> </li> <li class=md-nav__item> <a href=../../playground/rt-data-processing/ class=md-nav__link> Data processing </a> </li> <li class=md-nav__item> <a href=../../playground/spark-emr/ class=md-nav__link> Analytics on EMR </a> </li> <li class=md-nav__item> <a href=../../playground/ecs/ class=md-nav__link> ECS </a> </li> <li class=md-nav__item> <a href=../../playground/s3-org-billing/ class=md-nav__link> S3 storage lens </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/big-data-tenant-analytics/ class=md-nav__link> SaaS demo </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Coding <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Coding data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../coding/ class=md-nav__link> Practices </a> </li> <li class=md-nav__item> <a href=../../coding/cloudFormation/ class=md-nav__link> CloudFormation </a> </li> <li class=md-nav__item> <a href=../../coding/cdk/ class=md-nav__link> CDK </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> Return to main </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#sqs-standard-queue class=md-nav__link> SQS: Standard queue </a> <nav class=md-nav aria-label="SQS: Standard queue"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#fan-out-pattern class=md-nav__link> Fan-out pattern </a> </li> <li class=md-nav__item> <a href=#visibility-timeout class=md-nav__link> Visibility timeout </a> </li> <li class=md-nav__item> <a href=#dead-letter-queue class=md-nav__link> Dead Letter Queue </a> </li> <li class=md-nav__item> <a href=#fifo-queue class=md-nav__link> FIFO Queue </a> </li> <li class=md-nav__item> <a href=#security class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=#sample-code class=md-nav__link> Sample Code </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sns-simple-notification-service class=md-nav__link> SNS - Simple Notification Service </a> <nav class=md-nav aria-label="SNS - Simple Notification Service"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#combining-with-sqs-fan-out-pattern class=md-nav__link> Combining with SQS - Fan Out pattern </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#kinesis class=md-nav__link> Kinesis </a> </li> <li class=md-nav__item> <a href=#amazon-mq class=md-nav__link> Amazon MQ </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/jbcodeforce/aws-studies.git/edit/master/docs/infra/messaging.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=integration-and-middleware-sqs-sns>Integration and middleware: SQS, SNS<a class=headerlink href=#integration-and-middleware-sqs-sns title="Permanent link">&para;</a></h1> <h2 id=sqs-standard-queue>SQS: Standard queue<a class=headerlink href=#sqs-standard-queue title="Permanent link">&para;</a></h2> <ul> <li>Oldest queueing service on AWS. Full managed service. </li> <li>Unlimited throughput and unlimited number of message in queue</li> <li>The default retention is 4 days up to 14 days. low latency &lt; 10ms. </li> <li>Max mesage size is 256KB. </li> <li>Duplicate messages is possible (at least once delivery) and out of order too (best effort). </li> <li>Consumer deletes the message. </li> <li>Supports automatic scaling.</li> </ul> <p>Specific SDK to integrate to <code>SendMessage</code>, GetMessage...</p> <p>Consumers receive, process and then delete the messages. Parallelism is possible. The consumers can be in an auto scaling group (ASG) and with CloudWatch, it is possible to monitor the queue size / # of instances and in the CloudWatch alarm action, trigger EC2 scaling. </p> <p><img alt src=../images/SQS-ASG.png></p> <p>Message has metadata out of the box. After a message is polled by a consumer, it becomes invisible to other consumers. </p> <p><img alt=Metadata src=../images/sqs-msg.png></p> <h3 id=fan-out-pattern>Fan-out pattern<a class=headerlink href=#fan-out-pattern title="Permanent link">&para;</a></h3> <p>When we need to send the same message to more than one SQS consumer, we need to combine SNS and SQS: message is sent to the SNS topic and then "fan-out" to multiple SQS queues. It's fully decoupled, no data loss, and you have the ability to add more SQS queues (more applications) over time. This is the pattern to use if consumer may be down for a long period: solution based on SNS only will make some messages not processed and lost.</p> <h3 id=visibility-timeout>Visibility timeout<a class=headerlink href=#visibility-timeout title="Permanent link">&para;</a></h3> <p>By default, the “message visibility timeout” is 30 seconds, which means the message has 30 seconds to be processed (Amazon SQS prevents other consumers from receiving and processing the message). If a consumer fails to process a message within the Visibility Timeout, the message goes back to the queue.</p> <p><img alt src=../images/visibility-to.png></p> <p>After the message visibility timeout is over, the message is “visible” in SQS, therefore the message may be processed twice. But a consumer could call the <code>ChangeMessageVisibility</code> API to get more time to process. When the visibility timeout is high (hours), and the consumer crashes then the re-processing of all the messages will take time. If it is set too low (seconds), we may get duplicates.</p> <p>To reduce the number of API call to request message (improve latency and app performance), consumer can use the <code>long polling</code> API and wait for message arrival. </p> <h3 id=dead-letter-queue>Dead Letter Queue<a class=headerlink href=#dead-letter-queue title="Permanent link">&para;</a></h3> <p>We can set a threshold for how many times a message can go back to the queue. </p> <p>After the <code>MaximumReceives</code> threshold is exceeded, the message goes into a dead letter queue (DLQ) (which has a limit of 14 days to process).</p> <p><img alt=DLQ src=../images/sqs-dlq.png></p> <p>Delay queues let you postpone the delivery of new messages to a queue for a number of seconds. If you create a delay queue, any messages that you send to the queue remain invisible to consumers for the duration of the delay period. The default (minimum) delay for a queue is 0 seconds. The maximum is 15 minutes.</p> <p>For security, there is encryption in fight via HTTPS, and at rest with KMS keys. SQL API access control via IAM policies, and SQS Access Policies for cross-account access and for other AWS services to access SQS. </p> <p>It comes with monitoring.</p> <h3 id=fifo-queue>FIFO Queue<a class=headerlink href=#fifo-queue title="Permanent link">&para;</a></h3> <p>Queue can be set as FIFO to guaranty the order: limited to throughput at 300 msg/s without batching or 3000 msg/s with batching. It can also support exactly once delivery. While configuring the FIFO queue a parameter can be set to remove duplicate by looking at the content. <em>The name of the queue has to end with <code>.fifo</code></em>.</p> <p>If we don't use a Group ID, messages are consumed in the order they are sent, with only one consumer. But using Group ID we can have as many consumers as there is groups. It looks like partition key in kinesis data streams. Each consumer will get ordered records.</p> <h3 id=security>Security<a class=headerlink href=#security title="Permanent link">&para;</a></h3> <p>Access policies can be defined at the queue level or at the user level (using IAM policies) that can grant rights to perform queue-based actions like get/put/list.</p> <h3 id=sample-code>Sample Code<a class=headerlink href=#sample-code title="Permanent link">&para;</a></h3> <ul> <li><a href=https://boto3.amazonaws.com/v1/documentation/api/latest/guide/sqs.html>Python boto3 SQS</a></li> <li><a href=https://github.com/jbcodeforce/python-code>See Python aws folder</a></li> </ul> <h2 id=sns-simple-notification-service>SNS - Simple Notification Service<a class=headerlink href=#sns-simple-notification-service title="Permanent link">&para;</a></h2> <p>Used for pub/sub communication. Producer sends message to one SNS Topic. SNS pushes data to subscribers. SNS supports up to 12,500,000 subscriptions per topic, 100,000 topics limit. </p> <p>Each subscriber to the topic will get all the messages. As data is not persisted, we may lose messages not processed in a time window. </p> <p>The producers can publish to topic via SDK and can use different protocols like: HTTP / HTTPS (with delivery retries – how many times), SMTP, SMS, ... </p> <p>The subscribers can be a SQS, a Lambda, Kinesis Firehose, Emails... But not Kinesis Data Streams</p> <p>Many AWS services can send data directly to SNS for notifications: CloudWatch (for alarms), AWS budget, Lambda, Auto Scaling Groups notifications, Amazon S3 (on bucket events), DynamoDB, CloudFormation, AWS DMS, RDS Event.</p> <p>SNS can be combined with SQS: Producers push once in SNS, receive in all SQS queues that they subscribed to. It is fully decoupled without any data loss. SQS allows for data persistence, delayed processing and retries. SNS cannot send messages to SQS FIFO queues.</p> <p>For security it supports HTTPS, and encryption at REST with KSM keys. For access control, IAM policies can be defined for the SNS API (looks like S# policies). Same as SQS, used for cross account access and with other services. </p> <h3 id=combining-with-sqs-fan-out-pattern>Combining with SQS - Fan Out pattern<a class=headerlink href=#combining-with-sqs-fan-out-pattern title="Permanent link">&para;</a></h3> <ul> <li>An application puch once in a SNS Service, and the SQS queues are subscribers to the topic and then get the messages. Fan Out.</li> <li>Fully decoupled with no data loss</li> <li>SQS adds data persistence, delayed processing and retries of work</li> <li>Increase the number of subscriber over time.</li> <li>Using SNS FIFO and SQS FIFO it will keep ordering.</li> <li>Can use Message Filtering using a JSON policy </li> </ul> <h2 id=kinesis>Kinesis<a class=headerlink href=#kinesis title="Permanent link">&para;</a></h2> <p>See <a href=../../kinesis/ >dedicated note</a></p> <h2 id=amazon-mq>Amazon MQ<a class=headerlink href=#amazon-mq title="Permanent link">&para;</a></h2> <p>Amazon MQ is a managed message broker for RabbitMQ or ActiveMQ. It run on EC2 servers, and support multi-AZs deployment with failover. </p> <p>To support High availability, one server in a different AZ will be in passive mode, and will get data from Amazon EFS. </p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../monitoring/monitoring/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Monitoring" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Monitoring </div> </div> </a> <a href=../../kinesis/ class="md-footer__link md-footer__link--next" aria-label="Next: Kinesis*" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Kinesis* </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>