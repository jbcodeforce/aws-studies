<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>Security - AWS Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#security class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AWS Studies" class="md-header__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AWS Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Security </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/aws-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AWS Studies" class="md-nav__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> AWS Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/aws-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Infrastructure <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Infrastructure data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> EC2-others </a> </li> <li class=md-nav__item> <a href=../networking/ class=md-nav__link> Network </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Security <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Security </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=#encryption class=md-nav__link> Encryption </a> <nav class=md-nav aria-label=Encryption> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kms class=md-nav__link> KMS </a> </li> <li class=md-nav__item> <a href=#s3-considerations class=md-nav__link> S3 considerations </a> </li> <li class=md-nav__item> <a href=#encrypted-ami-sharing-process class=md-nav__link> Encrypted AMI sharing process </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#organizations class=md-nav__link> Organizations </a> <nav class=md-nav aria-label=Organizations> <ul class=md-nav__list> <li class=md-nav__item> <a href=#concepts class=md-nav__link> Concepts </a> </li> <li class=md-nav__item> <a href=#advantages class=md-nav__link> Advantages </a> </li> <li class=md-nav__item> <a href=#deeper-dive class=md-nav__link> Deeper Dive </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#iam-identity-and-access-management class=md-nav__link> IAM Identity and Access Management </a> <nav class=md-nav aria-label="IAM Identity and Access Management"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#security-policies class=md-nav__link> Security Policies </a> </li> <li class=md-nav__item> <a href=#multi-factor-authentication-mfa class=md-nav__link> Multi Factor Authentication - MFA </a> </li> <li class=md-nav__item> <a href=#iam-roles class=md-nav__link> IAM Roles </a> </li> <li class=md-nav__item> <a href=#permissions-boundary class=md-nav__link> Permissions boundary </a> </li> <li class=md-nav__item> <a href=#security-tools class=md-nav__link> Security tools </a> </li> <li class=md-nav__item> <a href=#iam-deeper-dive class=md-nav__link> IAM Deeper dive </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#amazon-cognito class=md-nav__link> Amazon Cognito </a> <nav class=md-nav aria-label="Amazon Cognito"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#examples class=md-nav__link> Examples </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#system-management-parameter-store class=md-nav__link> System management parameter store </a> </li> <li class=md-nav__item> <a href=#secrets-manager class=md-nav__link> Secrets Manager </a> </li> <li class=md-nav__item> <a href=#acm-certificate-manager class=md-nav__link> ACM - Certificate Manager </a> </li> <li class=md-nav__item> <a href=#waf-web-application-firewall class=md-nav__link> WAF Web Application Firewall </a> <nav class=md-nav aria-label="WAF Web Application Firewall"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deeper-dive_1 class=md-nav__link> Deeper dive </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#firewall-manager class=md-nav__link> Firewall manager </a> </li> <li class=md-nav__item> <a href=#shield class=md-nav__link> Shield </a> </li> <li class=md-nav__item> <a href=#guardduty class=md-nav__link> GuardDuty </a> </li> <li class=md-nav__item> <a href=#amazon-inspector class=md-nav__link> Amazon Inspector </a> </li> <li class=md-nav__item> <a href=#amazon-macie class=md-nav__link> Amazon Macie </a> </li> <li class=md-nav__item> <a href=#iam-identity-center class=md-nav__link> IAM Identity Center </a> </li> <li class=md-nav__item> <a href=#aws-cloudhsm class=md-nav__link> AWS CloudHSM </a> </li> <li class=md-nav__item> <a href=#aws-audit-manager class=md-nav__link> AWS Audit Manager </a> </li> <li class=md-nav__item> <a href=#aws-security-hub class=md-nav__link> AWS Security Hub </a> </li> <li class=md-nav__item> <a href=#aws-control-tower class=md-nav__link> AWS Control Tower </a> </li> <li class=md-nav__item> <a href=#security-faq class=md-nav__link> Security FAQ </a> </li> <li class=md-nav__item> <a href=#solution-design class=md-nav__link> Solution Design </a> <nav class=md-nav aria-label="Solution Design"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#blocking-ip-address class=md-nav__link> Blocking IP address </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#learn-more class=md-nav__link> Learn more </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../storage/ class=md-nav__link> S3-Storage </a> </li> <li class=md-nav__item> <a href=../route53/ class=md-nav__link> Route 53 </a> </li> <li class=md-nav__item> <a href=../../monitoring/monitoring/ class=md-nav__link> Monitoring </a> </li> <li class=md-nav__item> <a href=../messaging/ class=md-nav__link> Messaging </a> </li> <li class=md-nav__item> <a href=../../kinesis/ class=md-nav__link> Kinesis* </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Architecture <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Architecture data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sa/well-architectured/ class=md-nav__link> Well Architectured </a> </li> <li class=md-nav__item> <a href=../../sa/sol-design/ class=md-nav__link> Solution design </a> </li> <li class=md-nav__item> <a href=../../sa/psa-role/ class=md-nav__link> SA </a> </li> <li class=md-nav__item> <a href=../../sa/saas/ class=md-nav__link> SaaS </a> </li> <li class=md-nav__item> <a href=../../sa/resilience/ class=md-nav__link> Resilience </a> </li> <li class=md-nav__item> <a href=../../templ/ class=md-nav__link> Conduct Design session </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../analytics/ class=md-nav__link> Analytics </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Data <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Data data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/ class=md-nav__link> RDS-Aurora-ES </a> </li> <li class=md-nav__item> <a href=../../data/dynamodb/ class=md-nav__link> DynamoDB </a> </li> <li class=md-nav__item> <a href=../../data/data-lake/ class=md-nav__link> Data Lake </a> </li> <li class=md-nav__item> <a href=../../data/redshift/ class=md-nav__link> RedShift </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../ai-ml/ class=md-nav__link> AI-ML </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Serverless <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Serverless data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Serverless </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serverless/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../serverless/lambda/ class=md-nav__link> Lambda </a> </li> <li class=md-nav__item> <a href=../../serverless/apigtw/ class=md-nav__link> API Gateway </a> </li> <li class=md-nav__item> <a href=../../serverless/eks/ class=md-nav__link> EKS </a> </li> <li class=md-nav__item> <a href=../../serverless/eventbridge/ class=md-nav__link> EventBridge </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Playground <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Playground data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Playground </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../playground/gettingstarted/ class=md-nav__link> Getting Started IAM-EC2 </a> </li> <li class=md-nav__item> <a href=../../playground/rds/ class=md-nav__link> RDS </a> </li> <li class=md-nav__item> <a href=../../playground/rt-data-processing/ class=md-nav__link> Data processing </a> </li> <li class=md-nav__item> <a href=../../playground/spark-emr/ class=md-nav__link> Analytics on EMR </a> </li> <li class=md-nav__item> <a href=../../playground/ecs/ class=md-nav__link> ECS </a> </li> <li class=md-nav__item> <a href=../../playground/s3-org-billing/ class=md-nav__link> S3 storage lens </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/big-data-tenant-analytics/ class=md-nav__link> SaaS demo </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Coding <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Coding data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../coding/ class=md-nav__link> Practices </a> </li> <li class=md-nav__item> <a href=../../coding/cloudFormation/ class=md-nav__link> CloudFormation </a> </li> <li class=md-nav__item> <a href=../../coding/cdk/ class=md-nav__link> CDK </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> Return to main </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=#encryption class=md-nav__link> Encryption </a> <nav class=md-nav aria-label=Encryption> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kms class=md-nav__link> KMS </a> </li> <li class=md-nav__item> <a href=#s3-considerations class=md-nav__link> S3 considerations </a> </li> <li class=md-nav__item> <a href=#encrypted-ami-sharing-process class=md-nav__link> Encrypted AMI sharing process </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#organizations class=md-nav__link> Organizations </a> <nav class=md-nav aria-label=Organizations> <ul class=md-nav__list> <li class=md-nav__item> <a href=#concepts class=md-nav__link> Concepts </a> </li> <li class=md-nav__item> <a href=#advantages class=md-nav__link> Advantages </a> </li> <li class=md-nav__item> <a href=#deeper-dive class=md-nav__link> Deeper Dive </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#iam-identity-and-access-management class=md-nav__link> IAM Identity and Access Management </a> <nav class=md-nav aria-label="IAM Identity and Access Management"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#security-policies class=md-nav__link> Security Policies </a> </li> <li class=md-nav__item> <a href=#multi-factor-authentication-mfa class=md-nav__link> Multi Factor Authentication - MFA </a> </li> <li class=md-nav__item> <a href=#iam-roles class=md-nav__link> IAM Roles </a> </li> <li class=md-nav__item> <a href=#permissions-boundary class=md-nav__link> Permissions boundary </a> </li> <li class=md-nav__item> <a href=#security-tools class=md-nav__link> Security tools </a> </li> <li class=md-nav__item> <a href=#iam-deeper-dive class=md-nav__link> IAM Deeper dive </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#amazon-cognito class=md-nav__link> Amazon Cognito </a> <nav class=md-nav aria-label="Amazon Cognito"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#examples class=md-nav__link> Examples </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#system-management-parameter-store class=md-nav__link> System management parameter store </a> </li> <li class=md-nav__item> <a href=#secrets-manager class=md-nav__link> Secrets Manager </a> </li> <li class=md-nav__item> <a href=#acm-certificate-manager class=md-nav__link> ACM - Certificate Manager </a> </li> <li class=md-nav__item> <a href=#waf-web-application-firewall class=md-nav__link> WAF Web Application Firewall </a> <nav class=md-nav aria-label="WAF Web Application Firewall"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deeper-dive_1 class=md-nav__link> Deeper dive </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#firewall-manager class=md-nav__link> Firewall manager </a> </li> <li class=md-nav__item> <a href=#shield class=md-nav__link> Shield </a> </li> <li class=md-nav__item> <a href=#guardduty class=md-nav__link> GuardDuty </a> </li> <li class=md-nav__item> <a href=#amazon-inspector class=md-nav__link> Amazon Inspector </a> </li> <li class=md-nav__item> <a href=#amazon-macie class=md-nav__link> Amazon Macie </a> </li> <li class=md-nav__item> <a href=#iam-identity-center class=md-nav__link> IAM Identity Center </a> </li> <li class=md-nav__item> <a href=#aws-cloudhsm class=md-nav__link> AWS CloudHSM </a> </li> <li class=md-nav__item> <a href=#aws-audit-manager class=md-nav__link> AWS Audit Manager </a> </li> <li class=md-nav__item> <a href=#aws-security-hub class=md-nav__link> AWS Security Hub </a> </li> <li class=md-nav__item> <a href=#aws-control-tower class=md-nav__link> AWS Control Tower </a> </li> <li class=md-nav__item> <a href=#security-faq class=md-nav__link> Security FAQ </a> </li> <li class=md-nav__item> <a href=#solution-design class=md-nav__link> Solution Design </a> <nav class=md-nav aria-label="Solution Design"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#blocking-ip-address class=md-nav__link> Blocking IP address </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#learn-more class=md-nav__link> Learn more </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/jbcodeforce/aws-studies.git/edit/master/docs/infra/security.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=security>Security<a class=headerlink href=#security title="Permanent link">&para;</a></h1> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Updated 1/09/2023</p> </div> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">&para;</a></h2> <p>With the AWS Cloud, managing security and compliance is a <a href=https://aws.amazon.com/compliance/shared-responsibility-model/ >shared responsibility</a> between AWS and the customer:</p> <ul> <li><a href=https://aws.amazon.com/security/ >AWS is responsible of security <strong>of</strong> the cloud</a> and offers the most flexible and secure cloud computing environment available today. AWS is responsible for patching their managed services and infrastructure security.</li> <li>Customers are responsible for the security <strong>in</strong> the cloud: secure workloads and applications that are deployed onto the cloud. When using EC2, we are responsible to patch OS for security (but AWS helps by providing patched AMIs, or tools such as <a href=https://aws.amazon.com/systems-manager>Systems Manager</a>, or <a href=https://aws.amazon.com/inspector/ >Inspector</a> for continuous vulnerability testing).</li> </ul> <p>AWS runs highly secured data centers. Multiple geographic regions and Availability Zones allow customers to remain resilient in the face of most failure modes, from system failure to natural disasters. </p> <p>For highly regulated industry, AWS helps by getting more than 50 certifications for the infrastructure, globally but also regionaly for specific countries. At global, these include the <a href=https://www.iso.org/isoiec-27001-information-security.html>ISO 27001</a>, SOC 1 and 2 certifications. For regional in the USA, AWS aligns with <a href=https://www.cisa.gov/federal-information-security-modernization-act>FISMA</a> and <a href=https://www.gsa.gov/technology/government-it-initiatives/fedramp>FedRAMP</a>, in UK with Cyber Essentials, in Australia with IRA... The audits are done by a 3nd party and we can find reports in <a href=https://aws.amazon.com/artifact/ >aws/artifact</a>.</p> <p><a href=https://aws.amazon.com/financial-services/security-compliance/compliance-center/ >AWS Compliance Center is a central location to research cloud-related regulatory requirements</a></p> <p>Fine-grain identity and access controls combined with continuous monitoring for near real-time security information (<a href=https://aws.amazon.com/cloudtrail/ >CloudTrail</a>) ensures that the right resources have the right access at all times, wherever the information is stored</p> <h2 id=encryption>Encryption<a class=headerlink href=#encryption title="Permanent link">&para;</a></h2> <p>Encryption is widely available through a lot of services and features on top of the platform. We will be able to develop application that can encrypt data at rest, or in transit as it flows over the network between services. S3 storage or EBS block attached storage, have a single click option to do encryption at rest with keys (using KMS).</p> <p><img alt src=../images/security/EBS-encryption-rest.png></p> <p><strong>Figure 1: Encryption settings for EBS volume, using KMS</strong></p> <p>The managed service, <a href=https://aws.amazon.com/kms/ >AWS Key Management Service</a>, helps centrally managing our own keys. It is integrated into a lot of services and the keys never leave AWS <a href=https://en.wikipedia.org/wiki/FIPS_140-2>FIPS 140-validated</a> Hardware Security Modules unencrypted. User controls access and usage of the keys.</p> <p>With client side encryption, the data are encrypted by the client, and never decrypted by the Server. Only client with the data key can decrypt the data.</p> <h3 id=kms><a href=https://docs.aws.amazon.com/kms/latest/developerguide/overview.html>KMS</a><a class=headerlink href=#kms title="Permanent link">&para;</a></h3> <p>Managed service to help us create and control the cryptographic keys that are used to protect our data. It supports AWS, customer or custom keys:</p> <p><img alt src=../images/security/kms-1.png></p> <p><strong>Figure 2: KMS &amp; AWS keys</strong></p> <ul> <li>Integrated with IAM and most AWS services (EBS,S3, RDS, SSM...).</li> <li>Audit KMS Key usage using CloudTrail.</li> <li> <p>Two types of KMS Keys:</p> <ul> <li>Symmetric (AES 265 bits) is a single key used to encrypt and decrypt data. Must call KMS API to use it.</li> <li>Asymmetrics (RSA, ECC key pairs) - Public key to encrypt and private key to decrypt. Used to encrypt outside of AWS, with no KMS API access.</li> </ul> </li> <li> <p>For AWS managed keys, they are automatically rotated every year.</p> </li> <li>KMS Keys are per region. But when doing snapshot of a EBS volume and moving it to another region, AWS will reencrypt the data with a KMS key from the target region automatically. </li> <li>KMS Key policies help to control who (users, roles ) can access the KMS keys. Used to do cross account access: the copy of a encrypted snapshot done from origin account to the target account will use this policy to access the key to decrypt the snapshot, and then encrypt the copy with a new private key within the target account.</li> </ul> <p><img alt src=../images/security/kms-2.png></p> <p><strong>Figure 3: AWS key for S3 encryption, with Key policy</strong></p> <ul> <li> <p>To encrypt a local file using a symmetric Key in KMS, we can use the CLI like:</p> <div class=highlight><pre><span></span><code>aws kms encrypt --key-id alias/jb-key --plaintext fileb://ExampleSecretFile.txt --output text --query CiphertextBlob  --region eu-west-2 &gt; ExampleSecretFileEncrypted.base64
</code></pre></div> </li> <li> <p>To share the encrypted file, we can do: </p> <div class=highlight><pre><span></span><code>cat ExampleSecretFileEncrypted.base64 <span class=p>|</span> base64 --decode &gt; ExampleSecretFileEncrypted
</code></pre></div> </li> <li> <p>Then to decrypt this file using KMS:</p> <div class=highlight><pre><span></span><code>aws kms decrypt --ciphertext-blob fileb://ExampleSecretFileEncrypted   --output text --query Plaintext &gt; ExampleFileDecrypted.base64  --region eu-west-2
<span class=c1># back to the text version</span>
cat ExampleFileDecrypted.base64 <span class=p>|</span> base64 --decode &gt; ExampleFileDecrypted.txt
</code></pre></div> </li> </ul> <p>KMS supports also Multi-Region Keys, where primary key from one region is replicated to other regions. The Key ID stays the same. The idea is to be able to encrypt in one region and decrypt in another region. A use case will be to encrypt attribute of a DynamoDB Global Table with the Primary key, and let client who has access to the replicated key can decrypt the attribute with lower latency as it is done locally.</p> <p><img alt src=../diagrams/kms-dyn-gt.drawio.png></p> <p><strong>Figure 4: DB table encrypted and replicated with Keys</strong></p> <p>The attribute is decrypted only if the client has access to the KMS Key.</p> <h3 id=s3-considerations>S3 considerations<a class=headerlink href=#s3-considerations title="Permanent link">&para;</a></h3> <p>By default with SSE-S3 objects encrypted or not are replicated.</p> <p>With SSE-C, we provide the encryption key, so the encrypted objects are not replicated.</p> <p>With SSE-KMS then we need to specify the KMS Key to encrypt the object in target bucket, adapt the KMS policy so the key is accessible in another region, and in the IAM role, be sure <code>kms:Decrypt</code> is enabled for the source key and <code>kms:Encrypt</code> for the target KMS Key.</p> <h3 id=encrypted-ami-sharing-process>Encrypted AMI sharing process<a class=headerlink href=#encrypted-ami-sharing-process title="Permanent link">&para;</a></h3> <ul> <li>AMI in source account is encrypted with KMS Key from source account.</li> <li>AMI image should authorize the Launch permission for the target account.</li> <li>Define IAM role for the target account to use, and share KMS key accesses (DescribeKey, ReEncrypted, CreateGrant, Decrypt) via the role.</li> <li>When launching EC2 instance from this AMI in the target account, it is possible to use a new, local KMS key to re-encrypt the volumes.</li> </ul> <h2 id=organizations>Organizations<a class=headerlink href=#organizations title="Permanent link">&para;</a></h2> <p><a href=https://us-east-1.console.aws.amazon.com/organizations>AWS Organizations</a> helps to centraly manage multiple AWS accounts, group accounts, and simplify account creation. Using accounts helps to isolate AWS resources. It is a global service.</p> <h3 id=concepts>Concepts<a class=headerlink href=#concepts title="Permanent link">&para;</a></h3> <p><img alt src=../diagrams/organization.drawio.png width=600></p> <p><strong>Figure 5: Organization concepts</strong></p> <ul> <li>The main account is the management account where other added accounts are members.</li> <li>An organization is a hierarchical structure (a tree) with a root and Organization Units (OU), and AWS accounts.</li> <li>The <code>root</code> user is a single sign-in identity that has complete access to all AWS services and resources in any accounts.</li> <li>Organization unit (OU) contains AWS Accounts or other OUs. It can have only one parent.</li> </ul> <p><img alt src=../images/security/organization.png></p> <p><strong>Figure 6: Organization Services - manage accounts</strong></p> <ul> <li>OU can be per team, per line of business.</li> <li>AWS Organizations uses <a href=https://docs.aws.amazon.com/organizations/latest/userguide/orgs_integrate_services.html#orgs_integrate_services-using_slrs>IAM service-linked roles</a> to enable trusted services to perform tasks on your behalf in your organization's member accounts.</li> <li>We can create service control policies (SCPs) cross AWS accounts to deny access to AWS services for individuals or group of accounts in an OU. </li> <li>AWS Organization exposes APIs to automate account management.</li> <li>It helps consolidating billing accross all the accounts and user can get pricing benefits from aggregate usage. Shared reserved instances and Saving Plans discounts apply across accounts. Can define Blocklist or Allowlist strategies.</li> <li>There is no cost to use AWS Organizations.</li> <li>We can invite an existing AWS account to our organization. But payment changes of ownership. </li> </ul> <h3 id=advantages>Advantages<a class=headerlink href=#advantages title="Permanent link">&para;</a></h3> <ul> <li>Better isolation than VPC.</li> <li>Can use tagging for billing purpose.</li> <li>Enable CloudTrail for all accounts and get report in S3.</li> <li>Can define service control policies (SCP) as IAM policies applied to OU or Accounts to restric Users and Roles. Explicit allow. The root OU will have <code>FullAWSAccess</code> SCP. </li> </ul> <p><img alt src=../images/security/org-policies.png></p> <p><strong>Figure 7: Organization policies</strong></p> <h3 id=deeper-dive>Deeper Dive<a class=headerlink href=#deeper-dive title="Permanent link">&para;</a></h3> <ul> <li><a href=https://broadcast.amazon.com/videos/192190>Presentation on organizations</a></li> <li><a href=https://docs.aws.amazon.com/organizations/latest/userguide/orgs_introduction.html>User guide</a></li> <li><a href=https://docs.aws.amazon.com/organizations/latest/APIReference/API_Organization.html>Organization API</a></li> <li><a href=../../playground/s3-org-billing/ >S3 storage lens with Organization lab</a></li> </ul> <h2 id=iam-identity-and-access-management>IAM Identity and Access Management<a class=headerlink href=#iam-identity-and-access-management title="Permanent link">&para;</a></h2> <ul> <li>Helps to control access to AWS services.</li> </ul> <p><img alt src=../images/security/iam-authentication.png></p> <ul> <li>This is a global service, defined at the account level, cross regions.</li> <li>IAM helps us to define users (physical person), groups and roles, and permissions (policies).</li> </ul> <p><img alt src=../images/security/iam-groups.png> * Each account has a root user. Root user access should be set up to use MFA and complex password. Do not delete root user. * Do not use root user, but create user and always use them when login. <code>jerome</code>, <code>aws-jb</code> and <code>mathieu</code> are users. * Administrator users are part of an admin group with admin priviledges, like <code>AdministratorAccess</code>. * Assign users to groups (<code>admin</code> and <code>developers</code>) and assign policies to groups and not to individual user. * Groups can only contain users, not other groups. * Users can belong to multiple groups. * A classical use case: Create the user accounts, create a group for each department, create and attach an appropriate policy to each group, and place each user account into their departmentâ€™s group. When new team members are onboarded, create their account and put them in the appropriate group. If an existing team member changes departments, move their account to their new IAM group. * AWS Account has a unique ID but can be set with an alias. The console URL includes the user alias.</p> <h3 id=security-policies>Security Policies<a class=headerlink href=#security-policies title="Permanent link">&para;</a></h3> <ul> <li>Policies are written in JSON, to define permissions <code>Allow</code>, <code>Deny</code> for users to access AWS services, groups and roles...</li> <li>Policy applies to <strong>Principal</strong>: account/user/role, list the <strong>actions</strong> (what is allowed or denied) on the given <strong>resources</strong>.</li> <li> <p>It must define an ID, a version and statement(s):</p> <div class=highlight><pre><span></span><code><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>    </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w></span>
<span class=w>        </span><span class=p>{</span><span class=w></span>
<span class=w>            </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>            </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w></span>
<span class=w>                </span><span class=s2>&quot;iam:List*&quot;</span><span class=w></span>
<span class=w>            </span><span class=p>],</span><span class=w></span>
<span class=w>            </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;*&quot;</span><span class=w></span>
<span class=w>        </span><span class=p>}</span><span class=w></span>
<span class=w>    </span><span class=p>]</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <p>Another example to control access to IAM:</p> <p><img alt src=../images/security/aws-policy.png></p> </li> <li> <p>Use the <code>Least privilege permission</code> approach: Give users the minimal amount of permissions they need to do their job.</p> </li> <li>As soon as there is a deny in the chain of policy evaluation, then allows will not work. See the diagram below from <a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html>the product documentation</a> to review the decision flow to allow access to resource:</li> </ul> <p><img alt src=https://docs.aws.amazon.com/images/IAM/latest/UserGuide/images/PolicyEvaluationHorizontal111621.png></p> <ul> <li>Policy can define the password type <code>&gt; Account settings &gt; Password policy</code>, and when users are allowed to change the password.</li> <li>Inline policy can be defined at the user level, but it is recommended to use Group and Group level policies. As user can be part of multi groups, she/he will heritate to the different policies of those groups.</li> <li>IAM is not used for website authentication and authorization.</li> <li>For identity federation, use SAML standard.</li> <li>We can test Policies with the <a href=https://policysim.aws.amazon.com/home/index.jsp?#>policy simulator</a>.</li> <li>We can update a policy attached to a role and it takes immediate effect.</li> <li>Policies are not attached to AWS service, but to Roles.</li> <li>We can attach &amp; detach roles to running EC2, without having to stop and restart it.</li> </ul> <h3 id=multi-factor-authentication-mfa>Multi Factor Authentication - MFA<a class=headerlink href=#multi-factor-authentication-mfa title="Permanent link">&para;</a></h3> <ul> <li> <p>Multi Factor Authentication is used to verify a human is the real user of a service</p> <ul> <li>Always protect root account with MFA. </li> <li>MFA = password + device we own. </li> <li>The device could be a universal 2<sup>nd</sup> factor security key. (ubikey) </li> </ul> </li> <li> <p><a href=https://authy.com/ >Authy</a> is a multi-device service with free mobile app. We can have multiple users on the same device.</p> </li> </ul> <h3 id=iam-roles>IAM Roles<a class=headerlink href=#iam-roles title="Permanent link">&para;</a></h3> <ul> <li>To get AWS services doing work on other service, we need to use IAM Role and policies. Roles are assigned per application, or per EC2 or lambda function... A lot of roles are predefined and can be reused, and we can define new role for any service intance we create.</li> </ul> <p><img alt src=../images/security/iam-roles.png></p> <ul> <li>Maintaining roles, and policies within a role, is more efficient than maintaining policies for users. </li> <li>When a service assumes a role, IAM dynamically provides temporary credentials that expire after a defined period of time, between 15 minutes to 36 hours.</li> <li>IAM role does not create static access key, so no risk to have the key stolen.</li> </ul> <h4 id=ec2-example>EC2 example<a class=headerlink href=#ec2-example title="Permanent link">&para;</a></h4> <ul> <li>When connected to an EC2 machine via ssh or using EC2 Instance Connect tool, we need to set the IAM roles for who can use the EC2. A command like <code>aws iam list-users</code> will not work until a role is attached. For example, the <code>DemoEC2Role</code> role is defined to let IAM access in read only:</li> </ul> <p><img alt src=../images/security/aws-iam-role.png></p> <p>This role is then defined in the EC2 / Security &gt; attach IAM role, and now read-only commands with <code>aws iam</code> will work.</p> <h4 id=lamba-example>Lamba example<a class=headerlink href=#lamba-example title="Permanent link">&para;</a></h4> <p>We want to implement a lambda function, that will access S3 bucket to get file and another s3 bucket to put objects. We need a new role as illustrated in following figure, with permission to execute on lambda service, and trace qith XRay + a custom policy.</p> <p><img alt src=../images/security/s3-role.png></p> <p>See the Policies defined in <a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/s3-lambda>labs/s3-lambda</a>. AWSLambdaBasicExecutionRole is for logs, AWSXRayDaemonWriteAccess for the function to put traces into CloudWatch XRay.</p> <p>When defining the Lambda function we select the role we defined with the permissions we selected so the function can access other services. The role defines the permissions of our function. </p> <h4 id=resource-based-policy>resource-based policy<a class=headerlink href=#resource-based-policy title="Permanent link">&para;</a></h4> <p>When user, application or service assumes a role, it takes the permissions assigned to the role, and loose its original permissions. While when we use resource-based policy, the principal doesn't have to give up his permissions. For example if a user in Account A need to scan DynamoDB table in account A and dumpt it in S3 bucket in account B, then it is important to use resource-based policy for S3 bucket, so user does not loose its access to dynamoDB.</p> <p>This is also used for EventBridge to access lambda, SNS, SQS, cloudWatch logs, API gateway...</p> <h3 id=permissions-boundary>Permissions boundary<a class=headerlink href=#permissions-boundary title="Permanent link">&para;</a></h3> <p>Set a permissions boundary to control the maximum permissions a user can have. This is defined at user's or role level, and we define policy for example to authorize the user to do anything on EC2, CloudWatch or S3. </p> <p>The effective permission of a user is the join between Organization SCP, Permissions Boundary, and identity-based policies.</p> <p><img alt src=../diagrams/effective-perm.drawio.png></p> <p>Identity-based policies are attached to an IAM user, group, or role. These policies let you specify what that identity can do.</p> <p>This is used to:</p> <ul> <li>Delegate responsibilities to non-admin users within their permission boundaries to create specific resources, like IAM user.</li> <li>Allow developers to self-assign policies and manage their own permissions, while making sure they can increase their privileges.</li> <li>Restrict one user.</li> </ul> <h3 id=security-tools>Security tools<a class=headerlink href=#security-tools title="Permanent link">&para;</a></h3> <ul> <li>In IAM, use <code>&gt; Credentials report</code> to download account based report.</li> <li>In IAM, use <code>&gt; Users &gt; select one user (aws-jb) and then Access Advisor tab</code>: Access Advisor shows the services that the selected user can access and when those services were last accessed.</li> <li><a href=https://aws.amazon.com/guardduty/ >Amazon GuardDuty</a> is a security tool to continuously monitor your AWS accounts, instances, containers, users, and storage for potential threats.</li> </ul> <h3 id=iam-deeper-dive>IAM Deeper dive<a class=headerlink href=#iam-deeper-dive title="Permanent link">&para;</a></h3> <ul> <li><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic.html>Policy evaluation logic</a></li> </ul> <h2 id=amazon-cognito><a href=https://docs.aws.amazon.com/cognito/latest/developerguide/what-is-amazon-cognito.html>Amazon Cognito</a><a class=headerlink href=#amazon-cognito title="Permanent link">&para;</a></h2> <p>Amazon Cognito is a managed service which offers Authentication and Authorization features, it has <strong>User pools</strong> and <strong>Identity pools</strong>. It is scalable and highly available. Allows user to add user registration, sign in, and define access control.</p> <ul> <li>Supports standards based identity providers like OAuth 2.0, SAML, OIDC.</li> <li><strong>User pools</strong> are user directories that provide sign-up and sign-in options for your app or mobile users. </li> <li>User pool is for sign-in functionality, and it integrates with API Gateway and ALB. </li> <li><strong>Identity pools</strong> provide AWS credentials to grant your users access to your API, other AWS services via IAM permissions.</li> </ul> <p><img alt src=https://docs.aws.amazon.com/images/cognito/latest/developerguide/images/scenario-cup-cib2.png></p> <ul> <li>Free tier of 50,000 MAUs for users who sign in directly to Cognito User Pools and 50 MAUs for users federated through SAML 2.0 based identity providers.</li> <li>Users can sign in through social identity providers like Google, Facebook, and Amazon. They can also sign in through enterprise providers like ADFS and Okta with SAML 2.0 and OpenID Connect authentication.</li> <li>Use Amazon Cognito's built-in UI and options for federating with multiple identity providers to add user sign-in, sign-up into an application. </li> <li>use <a href=https://docs.amplify.aws/ >AWS Amplify</a> and the <a href=https://docs.amplify.aws/start/ >aws-amplify-vue</a> module to provide basic user sign up, sign in, and sign out functionality.</li> </ul> <h3 id=examples>Examples<a class=headerlink href=#examples title="Permanent link">&para;</a></h3> <ul> <li>Configure how user login:</li> </ul> <p><img alt src=../images/security/cognito-conf-1.png></p> <ul> <li>Then define if you want to use MFA, get an option to reset password..</li> <li>Configure sign-up and message delivery. We can disable auto sign-up and sending email.</li> </ul> <h2 id=system-management-parameter-store><a href=https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html>System management parameter store</a><a class=headerlink href=#system-management-parameter-store title="Permanent link">&para;</a></h2> <p>Managed service, serverless, it is a secure storage for configuration and secrets. </p> <p><img alt src=../images/security/ssm-parameter.png></p> <p>SSM Parameter Store has built-in version tracking capability. Each time we edit the value of a parameter, SSM Parameter Store creates a new version of the parameter and retains the previous versions.</p> <p>It stores data in a hierarchical tree. For example </p> <div class=highlight><pre><span></span><code>aws ssm get-parameters-by-path --path /an-app/dev/
</code></pre></div> <h2 id=secrets-manager><a href=https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html>Secrets Manager</a><a class=headerlink href=#secrets-manager title="Permanent link">&para;</a></h2> <p>Keep Secret information, with automatic rotation enforced, with integration with RDS, Redshift, DocumentDB. Secrets can be replicated between regions. </p> <h2 id=acm-certificate-manager><a href=https://docs.aws.amazon.com/acm/latest/userguide/acm-overview.html>ACM - Certificate Manager</a><a class=headerlink href=#acm-certificate-manager title="Permanent link">&para;</a></h2> <p>Manage and deploy TLS certificates. Supports public and private certificates. Automatic renewal.</p> <p>Free of charge for public certificates. </p> <p>Integrated with ELBs, Cloudfront, APIs on API gateway. Cannot use ACM with EC2.</p> <h2 id=waf-web-application-firewall><a href=https://docs.aws.amazon.com/waf/latest/developerguide/waf-chapter.html>WAF Web Application Firewall</a><a class=headerlink href=#waf-web-application-firewall title="Permanent link">&para;</a></h2> <p>User to monitor the HTTP(S) requests that are forwarded to your protected (Layer 7) web application resources. It is deployed on ALB, API Gateway, CloudFront, AppSync GraphQL API, Cognito User Pool.</p> <p>Rules are defined in Web Access Control List: they can apply to IP@, HTTP headers, body, URI strings, Cross-site Scripting... We can define size constraints, geographic matches, or rate-based rules for DDoS protection. For example we can implement a rule capable of blocking all IPs that have more than 2,000 requests in the last 5 minute interval.</p> <p>WebACL is regional, except for CloudFront.</p> <h3 id=deeper-dive_1>Deeper dive<a class=headerlink href=#deeper-dive_1 title="Permanent link">&para;</a></h3> <ul> <li><a href=https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-statement-type-rate-based.html>Rate-based rule statement</a></li> <li><a href=https://aws.amazon.com/waf/faqs/ >WAS FAQ</a></li> </ul> <h2 id=firewall-manager><a href=https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html>Firewall manager</a><a class=headerlink href=#firewall-manager title="Permanent link">&para;</a></h2> <p>Firewall manager simplifies your administration and maintenance tasks across multiple accounts (across AWS Organizations) and resources for a variety of protections, including AWS WAF, AWS Shield Advanced, Amazon VPC security groups, AWS Network Firewall, and Amazon Route 53 Resolver DNS Firewall. </p> <h2 id=shield><a href=https://aws.amazon.com/shield/ >Shield</a><a class=headerlink href=#shield title="Permanent link">&para;</a></h2> <p>To protect against DDoS attack.</p> <p>All AWS customers benefit from the automatic protections of AWS Shield Standard at no additional charge.</p> <p>When you use AWS Shield Standard with Amazon CloudFront and Amazon Route 53, you receive comprehensive availability protection against all known infrastructure (Layer 3 and 4) attacks.</p> <p>For more protection for EC2, ELB, CloudFront, Global Accelerator, Route 53... the advanced otion supports network and transport layer protections with near real-time visibility into attacks and 24/7 access to Shield Response Team.</p> <h2 id=guardduty><a href=https://docs.aws.amazon.com/guardduty/latest/ug/what-is-guardduty.html>GuardDuty</a><a class=headerlink href=#guardduty title="Permanent link">&para;</a></h2> <p>Amazon GuardDuty is a threat detection service that continuously monitors for malicious activity and unauthorized behavior to protect your AWS accounts, workloads, and data stored in Amazon S3.</p> <p>Security monitoring service that analyzes and processes data sources such as:</p> <ul> <li>AWS CloudTrail data events for Amazon S3 logs, </li> <li>CloudTrail management event logs, </li> <li>DNS logs, </li> <li>Amazon EBS volume data, </li> <li>Kubernetes audit logs, </li> <li>Amazon VPC flow logs</li> <li>RDS login activity</li> </ul> <p>It uses ML/AI model, anomaly detection, and integrated threat intelligence to identify and prioritize potential threats..</p> <p>GuardDuty can detect compromised EC2 instances and container workloads serving malware, or mining bitcoin.</p> <p>By integrating with Amazon EventBridge Events, GuardDuty alerts are actionable, easy to aggregate across multiple accounts, and straightforward to push into existing event management and workflow systems.</p> <h2 id=amazon-inspector><a href=https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html>Amazon Inspector</a><a class=headerlink href=#amazon-inspector title="Permanent link">&para;</a></h2> <p>Vulnerability management service that continuously scans your AWS workloads for software vulnerabilities and unintended network exposure. Includes EC2 instance scan and container images in Amazon ECR.</p> <h2 id=amazon-macie><a href=https://docs.aws.amazon.com/macie/latest/user/what-is-macie.html>Amazon Macie</a><a class=headerlink href=#amazon-macie title="Permanent link">&para;</a></h2> <p>Amazon Macie is a fully managed data security service that uses Machine Learning to discover and protect your sensitive data stored in S3 buckets. It automatically provides an inventory of S3 buckets including a list of unencrypted buckets, publicly accessible buckets, and buckets shared with other AWS accounts. It allows you to identify and alert you to sensitive data, such as Personally Identifiable Information (PII).</p> <p>All Macie findings are sent to Amazon EventBridge and can also be published to AWS Security Hub to initiate automated remediation such as blocking public access to your S3 storage.</p> <h2 id=iam-identity-center><a href=https://docs.aws.amazon.com/singlesignon/index.html>IAM Identity Center</a><a class=headerlink href=#iam-identity-center title="Permanent link">&para;</a></h2> <p>Single sign-on managed services for all AWS accounts within AWS Organizations, cloud applications, SAML2.0-enabled applications, EC2 Windows instances. </p> <p>The identity provider can be an identity store in IAM Identity center or an Active Directory, OneLogin, Okta...</p> <ul> <li><a href=https://docs.aws.amazon.com/singlesignon/latest/APIReference/welcome.html>API reference</a></li> </ul> <h2 id=aws-cloudhsm>AWS <a href="https://aws.amazon.com/cloudhsm/?nc2=type_a">CloudHSM</a><a class=headerlink href=#aws-cloudhsm title="Permanent link">&para;</a></h2> <p><a href=https://docs.aws.amazon.com/cloudhsm/latest/userguide/introduction.html>AWS CloudHSM</a> (Hardware Security Module) helps you meet corporate, contractual, and regulatory compliance requirements for data security.</p> <p>A Hardware Security Module (HSM) provides secure key storage and cryptographic operations within a tamper-resistant hardware device. HSMs are designed to securely store cryptographic key material and use the key material without exposing it outside the cryptographic boundary of the hardware.</p> <p>We can create a cluster that has from 1 to 28 HSMs (the default limit is 6 HSMs per AWS account per AWS Region).</p> <p><img alt src=https://docs.aws.amazon.com/images/cloudhsm/latest/userguide/images/cluster-architecture.png></p> <p>Example of use case is when hosted on EC2, must encrypt the data before writing this data to storage.</p> <p>We can also use AWS KMS if you need to encrypt data before writing it to storage when an AWS managed hardware security module for the cryptographic keys is not required.</p> <h2 id=aws-audit-manager><a href=https://docs.aws.amazon.com/audit-manager/latest/userguide/what-is.html>AWS Audit Manager</a><a class=headerlink href=#aws-audit-manager title="Permanent link">&para;</a></h2> <p>AWS Audit Manager is an automated service to continually audit your AWS usage to simplify how you manage risk and compliance with regulations and industry standards. It eifjcbfdjifhurnicntgjklgrihfkfcdfierkgkghcdi produces reports specific to auditors for PCI compliance, GDPR, and more.</p> <h2 id=aws-security-hub><a href=https://docs.aws.amazon.com/securityhub/latest/userguide/what-is-securityhub.html>AWS Security Hub</a><a class=headerlink href=#aws-security-hub title="Permanent link">&para;</a></h2> <p>AWS Security Hub is a Cloud Security Posture Management service that performs security best practice checks, aggregates alerts, and enables automated remediation.</p> <p>AWS Security Hub is a single place to view all your security alerts from services like Amazon GuardDuty, Amazon Inspector, Amazon Macie, and AWS Firewall Manager. It is not used for producing audit reports.</p> <h2 id=aws-control-tower><a href=https://docs.aws.amazon.com/controltower/latest/userguide/what-is-control-tower.html>AWS Control Tower</a><a class=headerlink href=#aws-control-tower title="Permanent link">&para;</a></h2> <p>AWS Control Tower orchestration extends the capabilities of AWS Organizations to set up and govern multi-account environment. It leverages SCPs for preventative guardrails and AWS Config for detective guardrails.</p> <p>No additional charge exists for using AWS Control Tower. You only pay for the AWS services enabled by AWS Control Tower, and the services you use in your landing zone.</p> <h2 id=security-faq>Security FAQ<a class=headerlink href=#security-faq title="Permanent link">&para;</a></h2> <details class=-> <summary>Sensitive data in the cloud can be accessed by everyone</summary> <p>AWS storage managed services are secured by default. You control who can access your data. For example, in S3 bucket, objects, by default are only available by the owner who created them. IAM policies define access to buckets, and in S3 itself you can define policies. Some policies can be defined at the Account level to forbid to define public bucket. From detection services like <code>CloudTrail</code> and <code>CloudWatch</code> Events you can route events to security team or respond in real-time to those events with code in a Lambda function.</p> </details> <details class=-> <summary>Integrate with existing Directory?</summary> <p>IAM can integrate with your existing directory where you can map IAM groups to directory group membership.</p> </details> <details class=-> <summary>Running intrusion/penetration testing and vulnerability scan</summary> <p>You can run any of those tests on your own workloads and for the following services:</p> <ul> <li>Amazon EC2 instances</li> <li>NAT Gateways</li> <li>Elastic Load Balancers</li> <li>Amazon RDS</li> <li>Amazon CloudFront</li> <li>Amazon Aurora</li> <li>Amazon API Gateways</li> <li>AWS Fargate</li> <li>AWS Lambda and Lambda Edge functions</li> <li>Amazon Lightsail resources</li> <li>Amazon Elastic Beanstalk environments</li> </ul> <p>You need to sign a "Seek approval" document so AWS can understand what you are doing and is not searching for malicious activities on your account or triggers security alarms. To integrate Penetration tests in your CI/CD <a href=https://aws.amazon.com/inspector>Amazon Inspector</a> is an automated vulnerability management service that continually scans AWS workloads for software vulnerabilities and unintended network exposure.</p> </details> <details class=-> <summary>How to ensure RDS database can only be accessed using profile credentials specific to EC2 instance?</summary> <p>IAM has <a href=https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.IAMDBAuth.html>database authentication capabilities</a> that would allow an RDS database to only be accessed using the profile credentials specific to your EC2 instances.</p> </details> <details class=-> <summary>Specifics business oriented accreditations</summary> <p>The workload is certified by your 3nd party auditor. AWS provides the accreditation doc for infrastructure and hosting operations. You have full visibility into the logical infrastructure via API calls, so your auditors can get information on items like security group (firewall) rules or RDS configuration via API calls, or account access information through our API auditing service, <code>CloudTrail</code>.</p> </details> <details class=-> <summary>How does IDS/IPS works on AWS?</summary> <p>Intrusion Detection and Prevention can be achieved in number of ways. There are tools/services like <code>Guard Duty</code>, 3<sup>rd</sup> party solution (AWS marketplace) as well architecture best practices. Amazon VPC traffic mirroring is a â€œvirtual fiber tapâ€ that gives you direct access to the network packets flowing through your VPC. </p> </details> <details class=-> <summary>Encrypted traffic between instances?</summary> <p>Within the AWS network, you'll be hosted in a Virtual Private Cloud (VPC) and all traffic between your instances stay within your VPC. Other customers cannot see your traffic. Configuring inter-instance traffic encryption would be the same as on-premises.</p> </details> <details class=-> <summary>Does AWS provide DDoS protection?</summary> <p><a href=https://aws.amazon.com/shield/ >AWS Shield Standard</a> is automically provided to all AWS customers and AWS Shield advanced service can be bought for additional features. AWS Shield is a managed Distributed Denial of Service events protection service that safeguards applications running on AWS.</p> </details> <details class=-> <summary>How to be sure to data is really deleted</summary> <p>You own the data inside AWS. But on delete operation the data is destroyed and wiped out. When destroying physical hardware, AWS follows the NIST 888 requirements, and it is done in a secure zone in the data center. Audits are done by 3nd party vendor, and compliances are reported in <a href=https://aws.amazon.com/artifact>Artifact</a>.</p> </details> <details class=-> <summary>Is serverless secured?</summary> <p>Roles are defined to define who can push code, access it, and fine grained control of the serverless execution. All serverless managed services inherit from the underlying platform security control. As an example, Lambda execution are authenticated, authorized and are made visible to the SREs via the commong logging mechanism.</p> </details> <h2 id=solution-design>Solution Design<a class=headerlink href=#solution-design title="Permanent link">&para;</a></h2> <p>The most important questions to ask and address when designing AWS solution with security consideration are:</p> <ul> <li>who can access the resources in the account.</li> <li>what can access the resources, and how access is allowed.</li> </ul> <p>Address how to secure, web tier, app tier and database access. What firewalls to use, and where.</p> <p>For each compute resources address access to monitoring and logging and network environment that contain those resources. </p> <p>Is there any Gateway needed?</p> <p>Finally consider data life cycle and access control over time. What are the compliance requirements? </p> <h3 id=blocking-ip-address>Blocking IP address<a class=headerlink href=#blocking-ip-address title="Permanent link">&para;</a></h3> <ul> <li> <p>At the VPC level, the best approach is to use Network ACL, when EC2 is exposed via public IP address, as illustrasted in the diagram below:</p> <p><img alt src=../diagrams/security/sa-sol-1.drawio.png></p> <p>Use a denial rule in NACL on specific IP address. Security group inbound rule specifies allowed only IP range, which should work, but then it blocks larger set of clients, so it will not be a solution for global application. Running a firewall on the EC2 will help, but it is more complex to administer. </p> </li> <li> <p>If an ALB is in the middle, then the EC2 security group will specify the SG of the ALB, and we are still using NACL. </p> <p><img alt src=../diagrams/security/sa-sol-2.drawio.png></p> <p>ALB does connection termination, so client will not be able to attack EC2.</p> <p>To add more control we can add a Web Application Firewall to add complex filtering on the IP @.</p> </li> <li> <p>Using a NLB, there will be no security group at the network load balancer, so traffic reaches EC2s. In this case only the NACL rules will help to protect. </p> </li> <li> <p>When using CloudFront, we need to add WAF, as NACL at the VPC level will not work, the ALB being connected to the cloudFront IP address, only (via security group).</p> <p><img alt src=../diagrams/security/sa-sol-3.drawio.png></p> <p>Geo restriction can be defined at the cloud front level, to deny a complete country for example.</p> </li> </ul> <h2 id=learn-more>Learn more<a class=headerlink href=#learn-more title="Permanent link">&para;</a></h2> <ul> <li><a href=https://aws.amazon.com/campaigns/cloud-security/data-safe-cloud-checklist/ >Data Safe cloud checklist</a></li> <li><a href="https://www.youtube.com/watch?v=MxDO78BYsU0">Top security myth - dispelled</a></li> </ul> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../networking/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Network" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Network </div> </div> </a> <a href=../storage/ class="md-footer__link md-footer__link--next" aria-label="Next: S3-Storage" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> S3-Storage </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>