<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>Network - AWS Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#networking class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AWS Studies" class="md-header__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AWS Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Network </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/aws-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AWS Studies" class="md-nav__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> AWS Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/aws-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Infrastructure <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Infrastructure data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> EC2-others </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Network <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Network </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#virtual-private-cloud class=md-nav__link> Virtual Private Cloud </a> <nav class=md-nav aria-label="Virtual Private Cloud"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#routing-tables class=md-nav__link> Routing Tables </a> </li> <li class=md-nav__item> <a href=#hands-on-work class=md-nav__link> Hands-on work </a> </li> <li class=md-nav__item> <a href=#deeper-dive class=md-nav__link> Deeper Dive </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#elastic-network-insterfaces class=md-nav__link> Elastic Network Insterfaces </a> </li> <li class=md-nav__item> <a href=#bastion-host class=md-nav__link> Bastion Host </a> </li> <li class=md-nav__item> <a href=#nat-gateway class=md-nav__link> NAT Gateway </a> </li> <li class=md-nav__item> <a href=#network-acls class=md-nav__link> Network ACLs </a> </li> <li class=md-nav__item> <a href=#vpc-peering class=md-nav__link> VPC peering </a> </li> <li class=md-nav__item> <a href=#vpc-endpoint class=md-nav__link> VPC Endpoint </a> </li> <li class=md-nav__item> <a href=#vpc-flow-logs class=md-nav__link> VPC Flow Logs </a> </li> <li class=md-nav__item> <a href=#extended-picture class=md-nav__link> Extended picture </a> </li> <li class=md-nav__item> <a href=#direct-connect class=md-nav__link> Direct Connect </a> </li> <li class=md-nav__item> <a href=#transit-gateway class=md-nav__link> Transit Gateway </a> </li> <li class=md-nav__item> <a href=#elastic-load-balancers class=md-nav__link> Elastic Load balancers </a> <nav class=md-nav aria-label="Elastic Load balancers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#load-balancer-stickiness class=md-nav__link> Load balancer stickiness </a> </li> <li class=md-nav__item> <a href=#cross-zone-load-balancing class=md-nav__link> Cross Zone Load Balancing </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tls-transport-layer-security class=md-nav__link> TLS - Transport Layer Security, </a> </li> <li class=md-nav__item> <a href=#connection-draining class=md-nav__link> Connection draining </a> </li> <li class=md-nav__item> <a href=#global-accelerator class=md-nav__link> Global Accelerator </a> </li> <li class=md-nav__item> <a href=#vpn-cloudhub class=md-nav__link> VPN CloudHub </a> </li> <li class=md-nav__item> <a href=#faqs class=md-nav__link> FAQs </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../security/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../storage/ class=md-nav__link> S3-Storage </a> </li> <li class=md-nav__item> <a href=../route53/ class=md-nav__link> Route 53 </a> </li> <li class=md-nav__item> <a href=../../monitoring/monitoring/ class=md-nav__link> Monitoring </a> </li> <li class=md-nav__item> <a href=../messaging/ class=md-nav__link> Messaging </a> </li> <li class=md-nav__item> <a href=../../kinesis/ class=md-nav__link> Kinesis* </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Architecture <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Architecture data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sa/well-architectured/ class=md-nav__link> Well Architectured </a> </li> <li class=md-nav__item> <a href=../../sa/sol-design/ class=md-nav__link> Solution design </a> </li> <li class=md-nav__item> <a href=../../sa/psa-role/ class=md-nav__link> SA </a> </li> <li class=md-nav__item> <a href=../../sa/saas/ class=md-nav__link> SaaS </a> </li> <li class=md-nav__item> <a href=../../sa/resilience/ class=md-nav__link> Resilience </a> </li> <li class=md-nav__item> <a href=../../templ/ class=md-nav__link> Conduct Design session </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../analytics/ class=md-nav__link> Analytics </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Data <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Data data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/ class=md-nav__link> RDS-Aurora-ES </a> </li> <li class=md-nav__item> <a href=../../data/dynamodb/ class=md-nav__link> DynamoDB </a> </li> <li class=md-nav__item> <a href=../../data/data-lake/ class=md-nav__link> Data Lake </a> </li> <li class=md-nav__item> <a href=../../data/redshift/ class=md-nav__link> RedShift </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../ai-ml/ class=md-nav__link> AI-ML </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Serverless <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Serverless data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Serverless </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serverless/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../serverless/lambda/ class=md-nav__link> Lambda </a> </li> <li class=md-nav__item> <a href=../../serverless/apigtw/ class=md-nav__link> API Gateway </a> </li> <li class=md-nav__item> <a href=../../serverless/eks/ class=md-nav__link> EKS </a> </li> <li class=md-nav__item> <a href=../../serverless/eventbridge/ class=md-nav__link> EventBridge </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Playground <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Playground data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Playground </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../playground/gettingstarted/ class=md-nav__link> Getting Started IAM-EC2 </a> </li> <li class=md-nav__item> <a href=../../playground/rds/ class=md-nav__link> RDS </a> </li> <li class=md-nav__item> <a href=../../playground/rt-data-processing/ class=md-nav__link> Data processing </a> </li> <li class=md-nav__item> <a href=../../playground/spark-emr/ class=md-nav__link> Analytics on EMR </a> </li> <li class=md-nav__item> <a href=../../playground/ecs/ class=md-nav__link> ECS </a> </li> <li class=md-nav__item> <a href=../../playground/s3-org-billing/ class=md-nav__link> S3 storage lens </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/big-data-tenant-analytics/ class=md-nav__link> SaaS demo </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Coding <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Coding data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../coding/ class=md-nav__link> Practices </a> </li> <li class=md-nav__item> <a href=../../coding/cloudFormation/ class=md-nav__link> CloudFormation </a> </li> <li class=md-nav__item> <a href=../../coding/cdk/ class=md-nav__link> CDK </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> Return to main </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#virtual-private-cloud class=md-nav__link> Virtual Private Cloud </a> <nav class=md-nav aria-label="Virtual Private Cloud"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#routing-tables class=md-nav__link> Routing Tables </a> </li> <li class=md-nav__item> <a href=#hands-on-work class=md-nav__link> Hands-on work </a> </li> <li class=md-nav__item> <a href=#deeper-dive class=md-nav__link> Deeper Dive </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#elastic-network-insterfaces class=md-nav__link> Elastic Network Insterfaces </a> </li> <li class=md-nav__item> <a href=#bastion-host class=md-nav__link> Bastion Host </a> </li> <li class=md-nav__item> <a href=#nat-gateway class=md-nav__link> NAT Gateway </a> </li> <li class=md-nav__item> <a href=#network-acls class=md-nav__link> Network ACLs </a> </li> <li class=md-nav__item> <a href=#vpc-peering class=md-nav__link> VPC peering </a> </li> <li class=md-nav__item> <a href=#vpc-endpoint class=md-nav__link> VPC Endpoint </a> </li> <li class=md-nav__item> <a href=#vpc-flow-logs class=md-nav__link> VPC Flow Logs </a> </li> <li class=md-nav__item> <a href=#extended-picture class=md-nav__link> Extended picture </a> </li> <li class=md-nav__item> <a href=#direct-connect class=md-nav__link> Direct Connect </a> </li> <li class=md-nav__item> <a href=#transit-gateway class=md-nav__link> Transit Gateway </a> </li> <li class=md-nav__item> <a href=#elastic-load-balancers class=md-nav__link> Elastic Load balancers </a> <nav class=md-nav aria-label="Elastic Load balancers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#load-balancer-stickiness class=md-nav__link> Load balancer stickiness </a> </li> <li class=md-nav__item> <a href=#cross-zone-load-balancing class=md-nav__link> Cross Zone Load Balancing </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#tls-transport-layer-security class=md-nav__link> TLS - Transport Layer Security, </a> </li> <li class=md-nav__item> <a href=#connection-draining class=md-nav__link> Connection draining </a> </li> <li class=md-nav__item> <a href=#global-accelerator class=md-nav__link> Global Accelerator </a> </li> <li class=md-nav__item> <a href=#vpn-cloudhub class=md-nav__link> VPN CloudHub </a> </li> <li class=md-nav__item> <a href=#faqs class=md-nav__link> FAQs </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/jbcodeforce/aws-studies.git/edit/master/docs/infra/networking.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=networking>Networking<a class=headerlink href=#networking title="Permanent link">&para;</a></h1> <p>All regions are interconnected via private AWS fiber links. This drives better availability, higher performance, lower jitter and reduced costs. Each region has redundant path to transit centers, which connect to private links to other AWS regions, and to AWS Direct Connect customers' data centers, internet via peering and paid transit. The connections between AZs is a metro area over DWDM (Dense wavelength division multiplexing) links. 82k fibers in a region. single digit milisecond latency. 25Tbps peak inter AZs traffic. </p> <p>IPv4 allows 3.7 billions of different addresses. Private IP @ is for private network connections. Internet gateway has public and private connections. Public IP can be geo-located. When connected to an EC2 the prompt lists the private IP (<code>ec2-user@ip-172-31-18-48</code>). Private IP stays stable on instance restart, while public may change.</p> <p>With Elastic IP address, we can mask an EC2 instance failure by rapidly remapping the address to another instance. But better to use DNS. Elastic IP is a public IPv4 that we own as long as we want and we can attach it to one EC2 instance at a time. It is not free.</p> <p>In the context of High Performance Computing (HPC) and ML applications, or OS-bypass, we can use EFA.</p> <h2 id=virtual-private-cloud>Virtual Private Cloud<a class=headerlink href=#virtual-private-cloud title="Permanent link">&para;</a></h2> <p>A virtual private cloud (VPC) is a virtual network dedicated to our AWS account. All new accounts have a default VPC. It is logically isolated from other virtual networks in the AWS Cloud. We can launch our AWS resources, such as Amazon EC2 instances, within our VPC. New EC2 instances are launched into the default VPC if no subnet is specified. </p> <p>When defining new VPC, we can specify CIDR, add subnets, associate security groups, ACL, and configure route tables.</p> <p><img alt src=../images/default-vpc.png></p> <p><strong>Figure 4: VPC</strong></p> <p>By default, AWS creates a VPC with default public subnets, one per AZs, they are public because the main route table sends the subnet's traffic that is destined for the internet to the internet gateway.</p> <p>VPC Helps to:</p> <ul> <li>Assign static IP addresses, potentially multiple addresses for the same EC2 instance.</li> <li>Change security group membership for our instances while they're running.</li> <li>Control the outbound traffic from our instances (egress filtering) in addition to controlling the inbound traffic to them (ingress filtering).</li> <li>We can have multiple VPCs per region (max to 5 but this is a soft limit). 5 maximum CIDR per VPC. </li> <li>The IP range is min /28 and max /16. </li> </ul> <p>Default VPC includes an <strong>Internet Gateway</strong>. Internet gateway is a managed service and automatically scales, is redundant and highly available.</p> <p>Network Access Control List can be defined at the VPC level, so will be shared between subnets. The default network ACL is configured to allow all traffic to flow in and out of the subnets which it is associated. Each network ACL also includes a rule whose rule number is an asterisk. This rule ensures that if a packet doesn't match any of the other numbered rules, it's denied. </p> <p>The following diagram illustrates classical VPC, as defined years ago, with one vpc, two availability zones, two public subnets with EC2 instances within those subnets and two AZs. An internet gateway connected to a router. Subnet is defined within a VPC and in one availability zone. It defines an IP CIDR range: we should have less IP on public subnet as they are used for ELB and very few resources. Most of the services should be in private subnet.</p> <p><img alt src=../images/vpc.png width=800></p> <p><strong>Figure 5: EC2s in public subnets</strong></p> <ul> <li><em>A subnet is assigned a /24 CIDR block, which means 8 bits encoding (32-24), but AWS uses 5 IP addresses in each subnet for gateway, LB,... so the number of available addresses is 256 - 5 = 251. To identify a single 32 bit IPv4 address, we can use /32 CIDR convention</em> </li> <li>Internet Gateway needs to be defined to any newly created VPC to get internet hosts being able to access EC2s. Route Tables need to be defined: one public associated with the public subnets and one private associated with private subnets.</li> <li>Non-default subnet has a private IPv4 address, but no public IPv4.</li> <li>We can make a default subnet into a private subnet by removing the route from the destination 0.0.0.0/0 to the Internet Gateway. The table in figure above defines such route, therefore the subnets are public.</li> <li>EC2 Instances should have either public IP or elastic IP and the subnet they belong to, must have a route to the internet gateway. The figure 5 above illustrates a route coming from any IP @ (0.0.0.0/0) goes to the internet gateway (<code>igw-id</code>). Any host in the private network 172.31.0.0/16 can communicate with other hosts in the local network.</li> <li>Route tables defines <code>172.31</code> as local with <code>/20</code> CIDR address range, internal to the VPC. Default route to internet goes to the IGW, which has an elastic IP address assigned to it.</li> <li>Because the VPC is cross AZs, we need a router to route between subnets. (See <a href=https://jbcodeforce.github.io/architecture/tcpip>TCP/IP summary</a>)</li> </ul> <h3 id=routing-tables>Routing Tables<a class=headerlink href=#routing-tables title="Permanent link">&para;</a></h3> <p>As illustrated in the following diagram, the main routing table addresses internal to the VPC traffic, while custom tables define how inbound and outbound traffic can be structured within a subnet. </p> <p><img alt src=../images/vpc-vpn.png></p> <p><strong>Figure 6: Routing tables</strong></p> <p>EC2 instances in subnet 2 are in private subnet. The corporate network, or on-premises network, can be connected to the VPC via customer gateway deployed on-premises, vitual private GTW in AWS region, and VPN connection between the two gateways.</p> <h3 id=hands-on-work>Hands-on work<a class=headerlink href=#hands-on-work title="Permanent link">&para;</a></h3> <p>The CDK example in <a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/cdk/ec2-vpc>the ec2-vpc folder</a> supports the following definitions:</p> <p><img alt src=../diagrams/hands-on-vpc.drawio.svg width=width></p> <p><strong>Figure 7: More classical VPC</strong></p> <ul> <li> <p>We can enable internet access for an EC2 instance launched into a non-default subnet by attaching an internet gateway to its VPC and configure routing tables for each subnets. The routes needs to define that traffic from internet goes to the IGW. The following route is associated to the public subnet-1:</p> <p><img alt src=../images/route-to-igw.png></p> <p><strong>Figure 8: Route to Internet Gateway</strong></p> </li> <li> <p>Alternatively, to allow an instance in our VPC to initiate outbound connections to the internet but prevents unsolicited inbound connections from the internet, we can use a Network Address Translation (NAT) service for IPv4 traffic. NAT maps multiple private IPv4 addresses to a single public IPv4 address, and does IP translation so host in the internet sees only public IP, original IP @ is in the header. </p> </li> <li> <p>In the private subnet, outbound to reach the internet has to go to the NAT Gateway, while traffic from machines in the subnets stays local, as illustrated in the following routing table: </p> <p><img alt src=../images/route-to-nat.png width=1000></p> <p><strong>Figure 9: Route to NAT Gateway</strong></p> </li> <li> <p>To use a <strong>Bastion Host</strong>, we attach a security group, to the EC2, to authorize inbound SSH and outbound HTTP traffic. CDK creates this SG automatically. So we can use Instance Connect to this instance, and within the terminal a ping to amazon.com will work. The bastion has a public IP address, and the VPC has a IGW with a route table.</p> <p><img alt src=../images/bastion-SG.png></p> <p><strong>Figure 10: Security group for bastion host authorize public access to port 22</strong></p> </li> <li> <p>In the EC2 instance running in the private network, we need to add a Security Group with an inbound rule to specify SSH traffic from the SG of the Bastion. With this settings a SSH to the Bastion, then a copy of the pem file in the bastion host and a command like: <code>ssh ec2-user@10.10.2.239 -i ec2.pem</code> on the private IP @ of the EC2 instance (10.10.2.239) will make the connection from Bastion to EC2.</p> <p><img alt src=../images/ec2-sg-private.png></p> <p><strong>Figure 11: Security group for EC2 to accept port 22 from Bastion only</strong></p> </li> <li> <p>IPv6 uses Egress only Internet Gateway for outbound requests from a private Subnet. For IPv4 oubtound internet traffic from a private subnet, we use a NAT instance or NAT Gateway.</p> </li> <li>NAT gateway is deployed inside a subnet and it can scale only inside that subnet. For fault tolerance, it is recommended that we deploy one NAT gateway per availability zone.</li> <li> <p>As we have set up a NAT Gateway in each public subnet, and the route in the private network route all IP to the NAT gateway, we can ping from the EC2 running in the private subnet to the internet:</p> <p><img alt src=../images/private-route-to-nat.png></p> <p><strong>Figure 12: Route to NAT to reach internet</strong> </p> </li> <li> <p>Here is the two NAT gateways, one in each subnet/AZ:</p> <p><img alt src=../images/nat-gtws.png></p> <p><strong>Figure 13: Two NAT gateways for HA</strong> </p> </li> <li> <p>A NAT device has an Elastic IP address and is connected to the internet through an internet gateway.</p> </li> </ul> <h3 id=deeper-dive>Deeper Dive<a class=headerlink href=#deeper-dive title="Permanent link">&para;</a></h3> <ul> <li><a href=https://aws.amazon.com/vpc/faqs/ >VPC FAQs</a>.</li> <li><a href=https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html>NAT gateway</a>.</li> </ul> <h2 id=elastic-network-insterfaces>Elastic Network Insterfaces<a class=headerlink href=#elastic-network-insterfaces title="Permanent link">&para;</a></h2> <p>ENI is a logical component in a VPC that represents a virtual network card. It has the following attributes:</p> <ul> <li>One primary private IPv4, one or more secondary IPv4.</li> <li>One Elastic IP (IPv4) per private IPv4.</li> <li>One Public IPv4.</li> <li>One or more security groups.</li> <li>A MAC address.</li> <li>We can create ENI independently and attach them on the fly (move them) on EC2 instances for failover purpose.</li> <li>Bound to a specific availability zone (AZ), We cannot attach ENI to an EC2 instance in a different AZ. </li> </ul> <p><a href=https://aws.amazon.com/blogs/aws/new-elastic-network-interfaces-in-the-virtual-private-cloud/ >New ENI doc.</a></p> <h2 id=bastion-host>Bastion Host<a class=headerlink href=#bastion-host title="Permanent link">&para;</a></h2> <p>The goal is to be able to access any EC2 instances running in the private subnets from outside of the VPC, using SSH. The bastion is running on public subnet, and then connected to the private subnets. The security group for the Bastion Host authorizies inbound on port 22 from restricted public CIDR. Security group of the EC2 instance allows the SG of the bastion host to accept connection on port 22.</p> <h2 id=nat-gateway><a href=https://docs.aws.amazon.com/vpc/latest/userguide/vpc-nat-gateway.html>NAT Gateway</a><a class=headerlink href=#nat-gateway title="Permanent link">&para;</a></h2> <p>Use a NAT gateway so that instances in a private subnet can connect to services outside our VPC but external services cannot initiate a connection with those instances.</p> <p>Charged for each hour that our NAT gateway is available and each Gigabyte of data that it processes.</p> <p>It is created in a specified AZ and uses an Elastic IP and can only be used by EC2 in other subnets. The route is from the private subnet to the NATGW to the IGW. To get HA we need one NATG per AZ. </p> <p>The bandwidth is from 5 Gbps to automatic scale up 45Gbps.</p> <h2 id=network-acls>Network ACLs<a class=headerlink href=#network-acls title="Permanent link">&para;</a></h2> <p>Defines traffic rule at the subnet level. One NACL per subnet. A NACL specifies rules with number that defines evaluation priority. The last rule is an asterisk and denies a request in case of no rule conditions match. As soon as a rule matches traffic, it’s applied immediately regardless of any higher-numbered rule that may contradict it</p> <p><img alt src=../images/nacl-default.png></p> <p><strong>Figure 14: Default NACL</strong> </p> <p>It is used to block a specific external IP address.</p> <p>The VPC automatically comes with a modifiable default network ACL. By default, it allows all inbound and outbound IPv4 traffic and, if applicable, IPv6 traffic. We can create a custom network ACL and associate it with a subnet. By default, each custom network ACL denies all inbound and outbound traffic until we add rules.</p> <p>Below is a complete figure to explain the process: A web server is initiating a connection to a DB on port 3306 and get response to an ephemeral port (allocated from 1024 to 65535):</p> <p><img alt src=../diagrams/nacl.drawio.png width=1000></p> <p><strong>Figure 15: Connection flow between public to private Apps</strong></p> <p>Each subnet in your VPC must be associated with a network ACL. If you don't explicitly associate a subnet with a network ACL, the subnet is automatically associated with the default network ACL.</p> <table> <thead> <tr> <th>Security Group</th> <th>Network ACL</th> </tr> </thead> <tbody> <tr> <td>Acts as firewall for EC2</td> <td>Acts as firewall for subnet</td> </tr> <tr> <td>Controls inbound &amp; outbound traffic at instance level</td> <td>Controls inbound &amp; outbound traffic at subnet level</td> </tr> <tr> <td>Supports allow rules</td> <td>Supports deny and allow rules</td> </tr> <tr> <td>Evaluates all rules before deciding to allow traffic</td> <td>Evaluate rules in order</td> </tr> <tr> <td>Instances associated with a SG can't talk to each other unless we add a rule to allow it</td> <td>Each subnet must be associated with a NACL.</td> </tr> </tbody> </table> <h2 id=vpc-peering>VPC peering<a class=headerlink href=#vpc-peering title="Permanent link">&para;</a></h2> <p>The goal of VPC peering is to connect two VPCs using AWS network and let them behave as if they were in the same network. When defining the VPC, the CICDs should not overlap. </p> <p>It could be used to connect VPC cross Regions and even cross Accounts.</p> <p>Once the VPC peering connection is defined, we still need to specify the route to the CIDR to reach the VPC peering created.</p> <p>VPC sharing (part of Resource Access Manager) allows multiple AWS accounts to create their application resources such as EC2 instances, RDS databases, Redshift clusters, and Lambda functions, into shared and centrally-managed Amazon Virtual Private Clouds (VPCs). To set this up, the account that owns the VPC (owner) shares one or more subnets with other accounts (participants) that belong to the same organization from AWS Organizations.</p> <p>After a subnet is shared, the participants can view, create, modify, and delete their application resources in the subnets shared with them. Participants cannot view, modify, or delete resources that belong to other participants or to the VPC owner.</p> <h2 id=vpc-endpoint><a href=https://docs.aws.amazon.com/vpc/latest/privatelink/create-interface-endpoint.html>VPC Endpoint</a><a class=headerlink href=#vpc-endpoint title="Permanent link">&para;</a></h2> <p>An interface VPC endpoint allows us to privately connect our Amazon VPC to supported AWS services. Interface VPC endpoints also connect to endpoint services hosted by other AWS customers and partners and AWS Marketplace partner services.</p> <p>VPC Endpoints remove the need of IGW, NATGW to access AWS Services. The service is redundant and scale horizontally. </p> <p>Two types of endpoint:</p> <ul> <li><strong>Interface endpoints</strong> powered by PrivateLink: it provisions an ENI in our VPC, with a security group. Pay per hour and GB of data transferred. It can access AWS services such as Simple Queue Service (SQS), Simple Notification Service (SNS), Amazon Kinesis.</li> <li><strong>Gateway endpoints</strong>: provision a GTW and setup routes in route tables. Used for <strong>S3 and DynamoDB</strong> only. Free. </li> </ul> <h2 id=vpc-flow-logs>VPC Flow Logs<a class=headerlink href=#vpc-flow-logs title="Permanent link">&para;</a></h2> <p>Capture IP traffic at the ENI, VPC, subnet level. This is used to monitor and troubleshoot connectivity issues. Can be save in S3 and CloudWatch logs. It can work on managed service like ELB, RDS, ElastiCache, RedShift, NATGW, Transit Gateway.</p> <p>The log includes src and destination addresses, port number and action done (REJECT/ ACCEPT).</p> <p>When an inboud request is rejected it could be a NACL or SG issue, while if the inbound is accepted but outbound reject it is only a NACL issue. </p> <p>VPC Flog log is defined within the VPC:</p> <p><img alt src=../images/vpc-flow-logs.png></p> <p><strong>Figure 16: VPC flow logs</strong></p> <p>The Flow can target S3, Firehouse or CloudWatch</p> <p><img alt src=../images/vpc-flow-create.png></p> <p><strong>Figure 17: VPC flow definition to CloudWatch</strong></p> <h2 id=extended-picture>Extended picture<a class=headerlink href=#extended-picture title="Permanent link">&para;</a></h2> <p>The following animation is presenting external integration from on-premises servers to AWS services and VPCs via site to site VPN, Private Gateway, Customer Gateway.</p> <p><img alt src=../images/vpc-anim.gif width=width></p> <p><strong>Figure 18: Full VPC diagram</strong></p> <ul> <li>We need to have <a href=https://wa.aws.amazon.com/wellarchitected/2020-07-02T19-33-23/wat.concept.vpc-endpoint.en.html>VPC endpoint service</a> to access <a href=https://docs.aws.amazon.com/vpc/latest/privatelink/aws-services-privatelink-support.html>the AWS services</a>, like S3, privately as they are in our VPC. </li> <li>We need to ensure there is one interface endpoint for each availability zone. </li> <li>We need to pick a subnet in each AZ and add an interface endpoint to that subnet. </li> <li> <p>TCP traffic is isolated. It is part of a larger offering called <a href=https://docs.aws.amazon.com/vpc/latest/privatelink/what-is-privatelink.html>AWS PrivateLink</a> to establish private connectivity between VPCs and services hosted on AWS or on-premises, without exposing data to the internet (No internet gateway, no NAT, no public IP @).</p> </li> <li> <p>CIDR Blocks should not overlap between VPCs for setting up a peering connection. Peering connection is allowed within a region, across regions, across different accounts.</p> </li> <li> <p>We can optionally connect our VPC to our own corporate data center using an IPsec AWS managed VPN connection, making the AWS Cloud an extension of our data center. A VPN connection consists of a virtual private gateway (VGW) attached to our VPC and a customer gateway located in the data center. </p> </li> <li>A Virtual Private Gateway is the VPN concentrator on the Amazon side of the VPN connection. </li> <li> <p>A customer gateway is a physical device or software appliance on the on-premise side of the VPN connection. We need to create a Site-to-site VPN connection between the CP GTW and Customer GTW.</p> </li> <li> <p>As seen in Figure 18 "Full VPC diagram", the <code>VPC peering</code> helps to connect between VPCs in different region, or within the same region. And <a href=https://docs.aws.amazon.com/vpc/latest/tgw/what-is-transit-gateway.html>Transit GTW</a> is used to interconnect our virtual private clouds (VPCs) and on-premises networks. In fact Transit Gateway is a more modern and easier approach to link VPCs. Using Transit Gateway route tables, We can control the traffic flow between VPCs. The peering connection would work; however, it requires a lot of point-to-point connections.</p> </li> <li>If we have multiple AWS Site-to-Site VPN connections, we can provide secure communication between sites using the <a href=https://docs.aws.amazon.com/vpn/latest/s2svpn/VPN_CloudHub.html>AWS VPN CloudHub</a>. This enables our remote sites to communicate with each other, and not just with the VPC. </li> <li>AWS VPN CloudHub operates on a simple hub-and-spoke model that we can use with or without a VPC.</li> </ul> <h2 id=direct-connect><a href=https://aws.amazon.com/directconnect/ >Direct Connect</a><a class=headerlink href=#direct-connect title="Permanent link">&para;</a></h2> <p>It provides a dedicated connection from a remote network to the VPC bypassing public internet. Need to setup a Virtual Private GTW. It is a private connection so it supports better bandwidth throughput at lower cost. It is not encrypted by default.</p> <p><img alt src=../diagrams/direct-conn.drawio.png></p> <p><strong>Figure 19: Direct Connect between on-premise and VPC</strong></p> <p>Get a direct connection setup can take more than a month. If we need to access two VPCs in two different regions from the corporate data center then we need a Direct Connect Gateway.</p> <p>To get reliability we can setup a VPN site to site connection in parallel to the Direct Connect link. For maximum resiliency for critical workloads, it is recommended to have double connections per data center.</p> <p><img alt src=../diagrams/direct-conn-ha.drawio.png></p> <p><strong>Figure 20: Direct Connect HA</strong></p> <p>Hosted Direct Connect connection supports 50Mbps, 500Mbps, up to 10Gbps, while Dedicated offers higher bandwidth.</p> <p>The main pricing parameter while using the Direct Connect connection is the Data Transfer Out (DTO) from AWS to the on-premises data center. DTO refers to the cumulative network traffic that is sent through AWS Direct Connect to destinations outside of AWS. This is charged per gigabyte (GB), and unlike capacity measurements, DTO refers to the amount of data transferred, not the speed.</p> <h2 id=transit-gateway><a href=https://aws.amazon.com/transit-gateway/ >Transit Gateway</a><a class=headerlink href=#transit-gateway title="Permanent link">&para;</a></h2> <p>This service aims to reduce complexity of interconnecting VPCs, it provides transitive peering between thousands of VPCs and on-premises, hub and spoke connection. It runs on the AWS global private network. </p> <p>Transit Gateway acts as a highly scalable cloud router—each new connection is made only once.</p> <p>It is a regional resource but it can run cross-region. It is also possible to share it across accounts using Resource Access Manager.</p> <p>Control the connection vias Route Tables. This is also the only service supporting IP multicast. </p> <p>To increase the bandwidth of the connection to VPC, there is the site to site VPN ECMP (Equal-cost multi-path routing) feature, which is a routing strategy to forward packet over multiple best paths. The VPCs can be from different accounts.</p> <p><img alt src=../diagrams/tg-ecmp.drawio.png></p> <p><strong>Figure 21: Transit Gateway between VPCs and On-premises</strong></p> <p>VPN connection to the Transit gateway with ECMP double the troughtput as it used double tunnels.</p> <h2 id=elastic-load-balancers>Elastic Load balancers<a class=headerlink href=#elastic-load-balancers title="Permanent link">&para;</a></h2> <p>Route traffic into the different EC2 instances. Elastic Load Balancing scales our load balancer capacity automatically in response to changes in incoming traffic. It is a managed service! And deployed per region.</p> <p>It also exposes a single point of access (DNS) to the deployed applications. In case of EC2 failure, it can route to a new instance, transparently and across multiple AZs. It uses health check (/health on the app called the <code>ping path</code>) to assess instance availability. It also provides SSL termination. It is used to separate private (internal) to public (external) traffic.</p> <p><img alt src=../images/elb-1.png></p> <p><strong>Figure 22: ELB</strong></p> <p>Need to enable availability zone to be able to route traffic between target groups in different AZs.</p> <p>When We create a load balancer, we must choose whether to make it an internal load balancer or an internet-facing load balancer. </p> <p>Internet-facing load balancers have public IP addresses. The DNS name of an internet-facing load balancer is publicly resolvable to the public IP addresses of the nodes. Internal load balancers have only private IP addresses. Internal load balancers can only route requests from clients with access to the VPC of the load balancer.</p> <p><img alt=2 src=../images/elb-scheme.png></p> <p><strong>Figure 23: Public and private ELBs</strong></p> <p>For certain needs, it also support stickness cookie to route to the same EC2 instance. ELB has security group defined for HTTP and HTTPS traffic coming from the internet, and the EC2 security group defines HTTP traffic to the ELB only.</p> <p>Four types of ELB supported:</p> <ul> <li><strong>Classic</strong> load balancer: older generation. TCP and HTTP layer. For each instance created, update the load balancer configuration so it can route the traffic.</li> <li> <p><strong>Application load balancer</strong>: HTTP, HTTPS (layer 7), Web Socket. </p> <ul> <li>It specifies availability zones: it routes traffic to the targets in these Availability Zones. Each AZ has one subnet. To increase availability, we need at least two AZs.</li> <li>It uses target groups, to group applications. So it can target containers running in one EC2 instance.</li> <li>route on URL, hostname and query string.</li> <li>Get a fixed hostname in DNS.</li> <li>the application do not see the IP address of the client directly (ELB does a connection termination), but ELB puts client information in the header <code>X-Forwarded-For</code> (IP @), <code>X-Forwarded-Port</code> (port #) and <code>X-Forwarded-Proto</code> (protocol).</li> <li>Great for microservices or for container based apps (ECS).</li> <li>Support dynamic port mapping for ECS container.</li> <li>Support HTTP/2 and WebSocket.</li> </ul> </li> </ul> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Target group: group EC2 instances by specifying Auto Scaling Group, but they also be task or containers in ECS, or lambda function. Health check is done at the target group level.</p> </div> <ul> <li> <p><strong>Network load balancer</strong>: TCP, UDP (layer 4), TLS</p> <ul> <li>Handle millions request/s.</li> <li>Reach less than 100ms latency while ALB is at 400ms.</li> <li>Use to get one public static IP address per availability zone.</li> <li>Routes each individual TCP connection to a single target for the life of the connection. If you specify targets using an instance ID, traffic is routed to instances using the primary private IP address specified in the primary network interface for the instance. If you specify targets using IP addresses, you can route traffic to an instance using any private IP address from one or more network interfaces. This enables multiple applications on an instance to use the same port</li> <li>Not free.</li> <li>Can reach target groups of EC2s, IP @, could be ALB.</li> <li>Health check is based on TCP, HTTP, and HTTPS.</li> <li>For NLB we need to add a rule in a the security group attached to the EC2 to get HTTP:80 to anywhere.</li> </ul> </li> <li> <p><strong>Gateway LB</strong>: </p> <ul> <li>Used to analyze in traffic before routing to applications.</li> <li>Applies firewalls rules, intrusion detection, deep packet inspection.</li> <li>Works at layer 3: IP packet.</li> <li>Combine NLB and gateway service.</li> <li>Also use target groups.</li> <li>Use the Geneve protocol (support network virtualization use cases for data center ) on port 6081 </li> </ul> </li> </ul> <p>To route traffic, first the DNS name of the load balancer is resolved. (They are part of the <code>amazaonaws.com</code> domain). 1 to many IP Addresses are sent back to the client. With NLBs, Elastic Load Balancing creates a network interface for each Availability Zone that we enable. Each load balancer node in the Availability Zone uses this network interface to get a static IP address. ELB scales our load balancer and updates the DNS entry. The time to live is set to 60s. </p> <p>To control that only the load balancer is sending traffic to the application, we need to set up an application <strong>security group</strong> on HTTP, and HTTPS with the source being the security group id of the ELB. LBs can scale but need to engage AWS operational team.</p> <p>HTTP 503 means LB is at capacity or target app is not registered. Verify security group in case of no communication between LB and app.</p> <p>Target group defines protocol to use, health check checking and what applications to reach (instance, IP or lambda). Below is an example of listener rule for an ALB:</p> <p><img alt=3 src=../images/ALB-listener-rules.png></p> <p><strong>Figure 23: ALB rule</strong></p> <p>ALB and Classic can use <a href=https://www.haproxy.com/blog/http-keep-alive-pipelining-multiplexing-and-connection-pooling/ >HTTP connection multiplexing</a> to keep one connection with the backend application. Connection multiplexing improves latency and reduces the load on our applications.</p> <h3 id=load-balancer-stickiness>Load balancer stickiness<a class=headerlink href=#load-balancer-stickiness title="Permanent link">&para;</a></h3> <p>Used when the same client needs to interact with the same backend instance. A cookie, with expiration date, is used to identify the client. The classical LB or ALB manages the routing. This could lead to unbalance traffic so overloading one instance. With ALB, stickness is configured in the target group properties.</p> <p>Two types of cookie:</p> <ul> <li><strong>Application-based cookie</strong>: generated by the target app. The cookie name is specific to the target group. </li> <li><strong>Duration-based cookie</strong>: generated by the Load Balancer.</li> </ul> <p>The following cookie names are reserved by the ELB (AWSALB, AWSALBAPP, AWSALBTG).</p> <h3 id=cross-zone-load-balancing>Cross Zone Load Balancing<a class=headerlink href=#cross-zone-load-balancing title="Permanent link">&para;</a></h3> <p>Each load balancer instance distributes traffic evenly across all registered instances in all availability zones. If one AZ has 2 targets and another one has 8 targets, then with cross-zone, the LBs in each availability zone will route to any instance, so each will receive 10% of the traffic. Without that, the 2 targets zone will receive 25% traffic each, and the instance on the othe AZ only 6.25% of the traffic. This is the default setting for ALB and free of charge. It is disabled by default for NLB.</p> <h2 id=tls-transport-layer-security>TLS - Transport Layer Security,<a class=headerlink href=#tls-transport-layer-security title="Permanent link">&para;</a></h2> <p>An SSL/TLS Certificate allows traffic between clients and load balancer to be encrypted in transit (in-flight encryption).</p> <ul> <li>Load balancer uses an X.509 certificate (SSL/TLS server certificate). </li> <li>Manage our own certificates using ACM (AWS Certificate Manager).</li> <li>When defining a HTTPS listener in a LB, we must specify a default certificate for the HTTPS protocol, while defining the routing rule to a given target group. Need multiple certs to support multiple domains. </li> <li>Clients can use SNI (Server Name Indication) to specify the hostname they want to reach. The ALB or NLB will get the certificates for each host to support the TLS handshake. </li> </ul> <h2 id=connection-draining>Connection draining<a class=headerlink href=#connection-draining title="Permanent link">&para;</a></h2> <p>This is a setting to control connection timeout and reconnect when an instance is not responding. It is to set up the time to complete “in-flight requests”. When an instance is "draining", ELB stops sending new requests to the instance. The time out can be adjusted, depending of the application, from 1 to 3600 seconds, default is 300 seconds, or disabled (set value to 0).</p> <p>It is called <code>Deregistration Delay</code> in NLB &amp; ALB.</p> <h2 id=global-accelerator><a href=https://docs.aws.amazon.com/global-accelerator/latest/dg/what-is-global-accelerator.html>Global Accelerator</a><a class=headerlink href=#global-accelerator title="Permanent link">&para;</a></h2> <p>AWS Global Accelerator is a network layer service that directs traffic to optimal endpoints over the AWS global network, this improves the availability and performance of Iour internet applications. </p> <p>It provides two static anycast IP addresses that act as a fixed entry point to our application endpoints in a single or multiple AWS Regions, such as our Application Load Balancers, Network Load Balancers, Elastic IP addresses or Amazon EC2 instances, in a single or in multiple AWS regions.</p> <p>The goal is to expose quickly an application to the WW. The problem is the number of internet hops done to access the target public ALB. The solution is to get as fast as possible to a AWS global network endpoint (Edge location), nearest region to the client. It is a global service.</p> <p>With Anycast IP a client is routed to the nearest server. All servers hold the same IP address. So for each application, we create 2 Anycast IP, and the traffic is sent to the edge locations.</p> <p>AWS Global Accelerator uses endpoint weights to determine the proportion of traffic that is directed to endpoints in an endpoint group, and traffic dials to control the percentage of traffic that is directed to an endpoint group</p> <p>Global Accelerator is a good fit for non-HTTP use cases, such as gaming (UDP), IoT (MQTT), or Voice over IP.</p> <h2 id=vpn-cloudhub>VPN CloudHub<a class=headerlink href=#vpn-cloudhub title="Permanent link">&para;</a></h2> <p>If we have multiple AWS Site-to-Site VPN connections, we can provide secure communication between sites using the AWS VPN CloudHub. </p> <p>This enables our remote sites to communicate with each other, and not just with the VPC. </p> <p>Sites that use AWS Direct Connect connections to the virtual private gateway can also be part of the AWS VPN CloudHub. </p> <p>The VPN CloudHub operates on a simple hub-and-spoke model that we can use with or without a VPC. </p> <p>This design is suitable if we have multiple branch offices and existing internet connections and would like to implement a convenient, potentially low-cost hub-and-spoke model for primary or backup connectivity between these remote offices.</p> <h2 id=faqs>FAQs<a class=headerlink href=#faqs title="Permanent link">&para;</a></h2> <details class=-> <summary>What differentiates a public subnet from a private subnet?</summary> <p>A public subnet is a subnet that's associated with a route table that has a route to an internet gateway</p> </details> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../ class="md-footer__link md-footer__link--prev" aria-label="Previous: EC2-others" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> EC2-others </div> </div> </a> <a href=../security/ class="md-footer__link md-footer__link--next" aria-label="Next: Security" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Security </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>