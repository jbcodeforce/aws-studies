<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>Getting Started IAM-EC2 - AWS Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#getting-started class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AWS Studies" class="md-header__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AWS Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Getting Started IAM-EC2 </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/aws-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AWS Studies" class="md-nav__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> AWS Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/aws-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Infrastructure <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Infrastructure data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../infra/ class=md-nav__link> EC2-others </a> </li> <li class=md-nav__item> <a href=../../infra/networking/ class=md-nav__link> Network </a> </li> <li class=md-nav__item> <a href=../../infra/security/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../../infra/storage/ class=md-nav__link> S3-Storage </a> </li> <li class=md-nav__item> <a href=../../infra/route53/ class=md-nav__link> Route 53 </a> </li> <li class=md-nav__item> <a href=../../monitoring/monitoring/ class=md-nav__link> Monitoring </a> </li> <li class=md-nav__item> <a href=../../infra/messaging/ class=md-nav__link> Messaging </a> </li> <li class=md-nav__item> <a href=../../kinesis/ class=md-nav__link> Kinesis* </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Architecture <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Architecture data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sa/well-architectured/ class=md-nav__link> Well Architectured </a> </li> <li class=md-nav__item> <a href=../../sa/sol-design/ class=md-nav__link> Solution design </a> </li> <li class=md-nav__item> <a href=../../sa/psa-role/ class=md-nav__link> SA </a> </li> <li class=md-nav__item> <a href=../../sa/saas/ class=md-nav__link> SaaS </a> </li> <li class=md-nav__item> <a href=../../sa/resilience/ class=md-nav__link> Resilience </a> </li> <li class=md-nav__item> <a href=../../templ/ class=md-nav__link> Conduct Design session </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../analytics/ class=md-nav__link> Analytics </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Data <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Data data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/ class=md-nav__link> RDS-Aurora-ES </a> </li> <li class=md-nav__item> <a href=../../data/dynamodb/ class=md-nav__link> DynamoDB </a> </li> <li class=md-nav__item> <a href=../../data/data-lake/ class=md-nav__link> Data Lake </a> </li> <li class=md-nav__item> <a href=../../data/redshift/ class=md-nav__link> RedShift </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../ai-ml/ class=md-nav__link> AI-ML </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Serverless <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Serverless data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Serverless </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serverless/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../serverless/lambda/ class=md-nav__link> Lambda </a> </li> <li class=md-nav__item> <a href=../../serverless/apigtw/ class=md-nav__link> API Gateway </a> </li> <li class=md-nav__item> <a href=../../serverless/eks/ class=md-nav__link> EKS </a> </li> <li class=md-nav__item> <a href=../../serverless/eventbridge/ class=md-nav__link> EventBridge </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8 checked> <label class=md-nav__link for=__nav_8> Playground <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Playground data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Playground </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Getting Started IAM-EC2 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Getting Started IAM-EC2 </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#defined-users-and-groups-with-iam class=md-nav__link> Defined users and groups with IAM </a> <nav class=md-nav aria-label="Defined users and groups with IAM"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#define-security-policies class=md-nav__link> Define security policies </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aws-cli-common-commands class=md-nav__link> AWS CLI common commands </a> </li> <li class=md-nav__item> <a href=#deploying-apache-http-on-ec2 class=md-nav__link> Deploying Apache HTTP on EC2 </a> <nav class=md-nav aria-label="Deploying Apache HTTP on EC2"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=#ssh-to-ec2 class=md-nav__link> SSH to EC2 </a> </li> <li class=md-nav__item> <a href=#ec2-instance-connect class=md-nav__link> EC2 Instance Connect </a> </li> <li class=md-nav__item> <a href=#access-to-service-within-the-ec2 class=md-nav__link> Access to service within the EC2 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#a-high-availability-webapp-deployment-summary class=md-nav__link> A High availability WebApp deployment summary </a> </li> <li class=md-nav__item> <a href=#create-a-ec2-instance-with-terraform class=md-nav__link> Create a EC2 instance with Terraform </a> </li> <li class=md-nav__item> <a href=#install-nginx-inside-a-ec2-t2micro class=md-nav__link> Install nginx inside a EC2 t2.micro. </a> </li> <li class=md-nav__item> <a href=#define-load-balancer class=md-nav__link> Define load balancer </a> </li> <li class=md-nav__item> <a href=#aws-cloud9 class=md-nav__link> AWS Cloud9 </a> </li> <li class=md-nav__item> <a href=#ecr-for-container-registry class=md-nav__link> ECR for Container Registry </a> </li> <li class=md-nav__item> <a href=#deploy-a-web-app-on-aws-elastic-beanstalk class=md-nav__link> Deploy a Web App on AWS Elastic Beanstalk </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../rds/ class=md-nav__link> RDS </a> </li> <li class=md-nav__item> <a href=../rt-data-processing/ class=md-nav__link> Data processing </a> </li> <li class=md-nav__item> <a href=../spark-emr/ class=md-nav__link> Analytics on EMR </a> </li> <li class=md-nav__item> <a href=../ecs/ class=md-nav__link> ECS </a> </li> <li class=md-nav__item> <a href=../s3-org-billing/ class=md-nav__link> S3 storage lens </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/big-data-tenant-analytics/ class=md-nav__link> SaaS demo </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Coding <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Coding data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../coding/ class=md-nav__link> Practices </a> </li> <li class=md-nav__item> <a href=../../coding/cloudFormation/ class=md-nav__link> CloudFormation </a> </li> <li class=md-nav__item> <a href=../../coding/cdk/ class=md-nav__link> CDK </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> Return to main </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#defined-users-and-groups-with-iam class=md-nav__link> Defined users and groups with IAM </a> <nav class=md-nav aria-label="Defined users and groups with IAM"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#define-security-policies class=md-nav__link> Define security policies </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#aws-cli-common-commands class=md-nav__link> AWS CLI common commands </a> </li> <li class=md-nav__item> <a href=#deploying-apache-http-on-ec2 class=md-nav__link> Deploying Apache HTTP on EC2 </a> <nav class=md-nav aria-label="Deploying Apache HTTP on EC2"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=#ssh-to-ec2 class=md-nav__link> SSH to EC2 </a> </li> <li class=md-nav__item> <a href=#ec2-instance-connect class=md-nav__link> EC2 Instance Connect </a> </li> <li class=md-nav__item> <a href=#access-to-service-within-the-ec2 class=md-nav__link> Access to service within the EC2 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#a-high-availability-webapp-deployment-summary class=md-nav__link> A High availability WebApp deployment summary </a> </li> <li class=md-nav__item> <a href=#create-a-ec2-instance-with-terraform class=md-nav__link> Create a EC2 instance with Terraform </a> </li> <li class=md-nav__item> <a href=#install-nginx-inside-a-ec2-t2micro class=md-nav__link> Install nginx inside a EC2 t2.micro. </a> </li> <li class=md-nav__item> <a href=#define-load-balancer class=md-nav__link> Define load balancer </a> </li> <li class=md-nav__item> <a href=#aws-cloud9 class=md-nav__link> AWS Cloud9 </a> </li> <li class=md-nav__item> <a href=#ecr-for-container-registry class=md-nav__link> ECR for Container Registry </a> </li> <li class=md-nav__item> <a href=#deploy-a-web-app-on-aws-elastic-beanstalk class=md-nav__link> Deploy a Web App on AWS Elastic Beanstalk </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/jbcodeforce/aws-studies.git/edit/master/docs/playground/gettingstarted.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=getting-started>Getting started<a class=headerlink href=#getting-started title="Permanent link">&para;</a></h1> <h2 id=defined-users-and-groups-with-iam>Defined users and groups with IAM<a class=headerlink href=#defined-users-and-groups-with-iam title="Permanent link">&para;</a></h2> <p>See <a href=../../infra/security/#iam-identity-and-access-management>summary on IAM</a></p> <ul> <li>Access the <a href=https://us-west-2.console.aws.amazon.com/ >AWS console</a> from which we can login as root user or as an IAM user: <code>aws-jb</code> for AWS account. (Or using personal account login to the account <a href=https://jbcodeforce.signin.aws.amazon.com/console]>https://jbcodeforce.signin.aws.amazon.com/console</a> with admin user <code>jerome</code>.</li> <li>In the IAM service, create groups (Developers, Adminstrators), define basic policies.</li> </ul> <h3 id=define-security-policies>Define security policies<a class=headerlink href=#define-security-policies title="Permanent link">&para;</a></h3> <p>Attached to the group level.</p> <h2 id=aws-cli-common-commands>AWS CLI common commands<a class=headerlink href=#aws-cli-common-commands title="Permanent link">&para;</a></h2> <p>We can access AWS using the CLI or the SDK which both user access keys generated from the console (&gt; Users &gt; jerome &gt; Security credentials &gt; Access Keys).</p> <p>The keys are saved in <code>~/.aws/credentials</code> in different profile * A named profile is a collection of settings and credentials that you can apply to a AWS CLI command. When you specify a profile to run a command, the settings and credentials are used to run that command. * Installation: <a href=https://aws.amazon.com/cli/ >aws cli</a> * The cli needs to be configured: <code>aws configure</code> with the credential, key and region to access. Use IAM user to get a new credentials key. The credentials and API key are in <code>~/.aws/credentials</code> in default profile</p> <p>Test with some commands:</p> <div class=highlight><pre><span></span><code>aws --version
<span class=c1># get your users</span>
aws iam list-users
<span class=c1># For a given profile</span>
aws iam list-users --profile hackaton
</code></pre></div> <ul> <li><a href=https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Scenarios-cli.html>VPC scenario with CLI - Tutorial</a></li> <li><a href=https://us-west-2.console.aws.amazon.com/cloudshell>Use CloudShell in west-2 region for using aws cli</a></li> <li><a href>aws-shell</a> is also available to facilitate the user experience in your laptop terminal console.</li> </ul> <p>When using CLI in a EC2 instance always use an IAM role to control security credentials. This role may come with a policy authorizing exactly what the EC2 instance should be able to do. </p> <p>Also within a EC2 instance, it is possible to use the URL http://169.254.169.254/latest/meta-data to get information about the EC2. We can retrieve the IAM Role name from that metadata.</p> <h2 id=deploying-apache-http-on-ec2>Deploying Apache HTTP on EC2<a class=headerlink href=#deploying-apache-http-on-ec2 title="Permanent link">&para;</a></h2> <p>Create a EC2 t2.micro instance with AWS Linux, a public IP address, a security group with SSH enabled from anywhere and HTTP on port 80 accessible from the internet. Associate the EC2 with a Key Pair so we can do SSH on the instance (and download the .pem file). The free tier is elligible to 30 GB of disk. Under the <code>Advanced details</code> section, add the following <code>bash</code> script in the <code>User Data</code> field:</p> <div class=highlight><pre><span></span><code><span class=ch>#!/bin/bash</span>
<span class=c1># update OS</span>
yum update -y
<span class=c1># Get Apache HTTPd</span>
yum install -y httpd
<span class=c1># Start the service</span>
systemctl start httpd
<span class=c1># Enable it cross restart</span>
systemctl <span class=nb>enable</span> httpd
&gt; Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service
<span class=c1># Get the availability zone</span>
EC2-AZ<span class=o>=</span><span class=k>$(</span>curl -s http://169.254.169.254/latest/meta-data/placement/availability-zone/<span class=k>)</span>
<span class=c1># Change the home page by changing /var/www/html/index.html</span>
<span class=nb>echo</span> <span class=s2>&quot;&lt;h1&gt;Hello from </span><span class=k>$(</span>hostname -f<span class=k>)</span><span class=s2>&lt;/h1&gt;&quot;</span> &gt; /var/www/html/index.html
<span class=c1># or use the following</span>
<span class=nb>echo</span> <span class=s2>&quot;&lt;h3&gt;Hello World from </span><span class=k>$(</span>hostname -f<span class=k>)</span><span class=s2> in AZ= </span><span class=nv>$EC2_AZ</span><span class=s2> &lt;/h3&gt;&quot;</span> &gt; /var/www/html/index.html
</code></pre></div> <p>Once launched, from the console, get the DNS name or the public IP address and try a curl or use your web browser to that HTTP address (not https).</p> <h3 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h3> <ul> <li>Connection timeout: Any timeout (not just for SSH) is related to security groups or a firewall rule. This may also mean a corporate firewall or a personal firewall is blocking the connection. Go to the security group and look at inbound rules.</li> <li><code>Permission denied (publickey,gssapi-keyex,gssapi-with-mic)</code>: You are using the wrong security key or not using a security key. </li> <li>"Able to connect yesterday, but not today": When you restart a EC2 instance, the public IP of your EC2 instance will change, so prefer to use the DNS name and not the IP @. </li> </ul> <h3 id=ssh-to-ec2>SSH to EC2<a class=headerlink href=#ssh-to-ec2 title="Permanent link">&para;</a></h3> <ul> <li>Get public IP address of the EC2 instance</li> <li>Get pem certificate for the CA while you created the EC2 via the Key pair (e.g. <code>my-key-pair.pem</code>)</li> <li>Issue the following command where the certificate is to open a SSH session</li> </ul> <div class=highlight><pre><span></span><code>ssh -i my-key-pair.pem ec2-user@35.91.239.193
</code></pre></div> <p>you should get the prompt:</p> <div class=highlight><pre><span></span><code>Last login: Wed Nov  <span class=m>2</span> <span class=m>17</span>:24:30 <span class=m>2022</span> from ec2-18-237-140-165.us-west-2.compute.amazonaws.com

       __<span class=p>|</span>  __<span class=p>|</span>_  <span class=o>)</span>
       _<span class=p>|</span>  <span class=o>(</span>     /   Amazon Linux <span class=m>2</span> AMI
      ___<span class=p>|</span><span class=se>\_</span>__<span class=p>|</span>___<span class=p>|</span>

https://aws.amazon.com/amazon-linux-2/
</code></pre></div> <h3 id=ec2-instance-connect>EC2 Instance Connect<a class=headerlink href=#ec2-instance-connect title="Permanent link">&para;</a></h3> <p>Access the EC2 terminal inside the web browser using SSH. Select the instance and then <code>Connect</code> button at the top. </p> <p><img alt src=../images/EC2-home.png></p> <p>It comes with the <code>aws cli</code>. Never enter any account id inside <code>aws configure</code> inside an EC2 instance, use IAM role instead.</p> <p>For example to access another service (like IAM), we need an IAM Role added to the EC2 instance: go to the EC2 instance, <code>Action &gt; Security &gt; Modify IAM Roles</code> add <code>DemoEC2Role</code> for example. We should be able to do <code>aws iam list-users</code> command.</p> <h3 id=access-to-service-within-the-ec2>Access to service within the EC2<a class=headerlink href=#access-to-service-within-the-ec2 title="Permanent link">&para;</a></h3> <p>To access to external AWS service we need to use IAM role. So define a Role in IAM </p> <p><img alt src=../images/iam-role.png></p> <p>with the Permission Policy linked to the resource you try to access, for example select on S3 policies to be able to access S3 bucket. </p> <p><img alt src=../images/s3-policies.png></p> <p>On an existing EC2 we can use the menu <code>Actions &gt; Security &gt; Modify IAM Roles</code>. </p> <h2 id=a-high-availability-webapp-deployment-summary>A High availability WebApp deployment summary<a class=headerlink href=#a-high-availability-webapp-deployment-summary title="Permanent link">&para;</a></h2> <p>Based on the AWS essential training, here is a quick summary of the things to do for a classical HA webapp deployment.</p> <ol> <li> <p>Create a VPC with private and public subnets, using at least 2 AZs. This is simplified with the new console which creates all those elements in one click:</p> <p><img alt src=../images/vpc-create.png></p> <p>The results, with all the networking objects created, look like below:</p> <p><img alt src=../images/vpc-result.png></p> </li> <li> <p>Verify routing table for public and private subnets. </p> </li> <li>Add security group to the VPC using HTTP and HTTPS to the internet gateway.</li> <li> <p>Start EC2 to one of the public subnet and define user data to start your app. Here is an example</p> <div class=highlight><pre><span></span><code><span class=ch>#!/bin/bash -ex</span>
yum -y update
curl -sL https://rpm.nodesource.com/setup_15.x <span class=p>|</span> bash -
yum -y install nodejs
mkdir -p /var/app
wget https://aws-tc-largeobjects.s3-us-west-2.amazonaws.com/ILT-TF-100-TECESS-5/app/app.zip
unzip app.zip -d /var/app/
<span class=nb>cd</span> /var/app
npm install
npm start
</code></pre></div> </li> <li> <p>Get the security key with .pem file for the public certificate</p> </li> <li>Be sure the inbound rules include HTTP and HTTPS on all IPv4 addresses defined in the security group. </li> </ol> <h2 id=create-a-ec2-instance-with-terraform>Create a EC2 instance with Terraform<a class=headerlink href=#create-a-ec2-instance-with-terraform title="Permanent link">&para;</a></h2> <ul> <li> <p>Build a main.tf <a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/terraform-vpc>labs/terraform-vpc</a>, which uses the aws provider to provision a micro EC2 instance:</p> <div class=highlight><pre><span></span><code><span class=kc>terraf</span><span class=err>orm</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=err>required_providers</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=err>aws</span><span class=w> </span><span class=err>=</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=err>source</span><span class=w>  </span><span class=err>=</span><span class=w> </span><span class=s2>&quot;hashicorp/aws&quot;</span><span class=w></span>
<span class=w>    </span><span class=err>versio</span><span class=kc>n</span><span class=w> </span><span class=err>=</span><span class=w> </span><span class=s2>&quot;~&gt; 3.27&quot;</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=err>required_versio</span><span class=kc>n</span><span class=w> </span><span class=err>=</span><span class=w> </span><span class=s2>&quot;&gt;= 0.14.9&quot;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=err>provider</span><span class=w> </span><span class=s2>&quot;aws&quot;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=err>pro</span><span class=kc>f</span><span class=err>ile</span><span class=w> </span><span class=err>=</span><span class=w> </span><span class=s2>&quot;default&quot;</span><span class=w></span>
<span class=w>    </span><span class=err>regio</span><span class=kc>n</span><span class=w>  </span><span class=err>=</span><span class=w> </span><span class=s2>&quot;us-west-2&quot;</span><span class=w></span>
<span class=p>}</span><span class=w></span>

<span class=err>resource</span><span class=w> </span><span class=s2>&quot;aws_instance&quot;</span><span class=w> </span><span class=s2>&quot;app_server&quot;</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>    </span><span class=err>ami</span><span class=w>           </span><span class=err>=</span><span class=w> </span><span class=s2>&quot;ami-830c94e3&quot;</span><span class=w></span>
<span class=w>    </span><span class=err>i</span><span class=kc>nstan</span><span class=err>ce_</span><span class=kc>t</span><span class=err>ype</span><span class=w> </span><span class=err>=</span><span class=w> </span><span class=s2>&quot;t2.micro&quot;</span><span class=w></span>

<span class=w>    </span><span class=kc>ta</span><span class=err>gs</span><span class=w> </span><span class=err>=</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>        </span><span class=err>Name</span><span class=w> </span><span class=err>=</span><span class=w> </span><span class=s2>&quot;ExampleAppServerInstance&quot;</span><span class=w></span>
<span class=w>    </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <p>Resource blocks contain arguments which you use to configure the resource. Arguments can include things like machine sizes, disk image names, or VPC IDs.</p> </li> </ul> <div class=highlight><pre><span></span><code>terraform apply
<span class=c1># inspect state</span>
terraform show
</code></pre></div> <h2 id=install-nginx-inside-a-ec2-t2micro>Install nginx inside a EC2 t2.micro.<a class=headerlink href=#install-nginx-inside-a-ec2-t2micro title="Permanent link">&para;</a></h2> <p>Be sure to have a policy to authorize HTTP inbound traffic on port 80 for 0.0.0.0/0.</p> <h2 id=define-load-balancer>Define load balancer<a class=headerlink href=#define-load-balancer title="Permanent link">&para;</a></h2> <p><img alt src=../images/aws-lb-1.png></p> <h2 id=aws-cloud9>AWS Cloud9<a class=headerlink href=#aws-cloud9 title="Permanent link">&para;</a></h2> <p>AWS Cloud9 is a cloud-based integrated development environment (IDE) that lets you write, run, and debug your code within a web browser.</p> <ol> <li>Go to the AWS Management Console, select Services then select Cloud9 under Developer Tools.</li> <li>Select Create environment.</li> <li>Enter Development into Name and optionally provide a Description.</li> <li>You may leave Environment settings at their defaults of launching a new t2.micro EC2 instance which will be paused after 30 minutes of inactivity.</li> <li>Once ready, your IDE will open to a welcome screen.</li> <li>Verify the environment with <code>aws sts get-caller-identity</code></li> </ol> <h2 id=ecr-for-container-registry>ECR for Container Registry<a class=headerlink href=#ecr-for-container-registry title="Permanent link">&para;</a></h2> <p>Amazon Elastic Container Registry (Amazon ECR) is an AWS managed container image registry service that is secure, scalable, and reliable.</p> <p>See <a href=https://docs.aws.amazon.com/AmazonECR/latest/userguide/what-is-ecr.html>Getting started guide</a> which can be summarized as</p> <ul> <li>Your client must authenticate to Amazon ECR registries as an AWS user before you can push and pull images. </li> <li>You can control access to your repositories and the images within them with repository policies.</li> </ul> <p><a href=https://gallery.ecr.aws/ >ECR public gallery</a> includes docker images to be reusable.</p> <h2 id=deploy-a-web-app-on-aws-elastic-beanstalk>Deploy a Web App on AWS Elastic Beanstalk<a class=headerlink href=#deploy-a-web-app-on-aws-elastic-beanstalk title="Permanent link">&para;</a></h2> <p>Elastic Beanstalk is an easy-to-use service for deploying and scaling web applications and services developed with Java, .NET, PHP, Node.js, Python, Ruby, Go, and Docker on familiar servers such as Apache, Nginx, Passenger, and IIS</p> <p><a href=https://aws.amazon.com/getting-started/guides/deploy-webapp-elb/ >Guide</a></p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../serverless/eventbridge/ class="md-footer__link md-footer__link--prev" aria-label="Previous: EventBridge" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> EventBridge </div> </div> </a> <a href=../rds/ class="md-footer__link md-footer__link--next" aria-label="Next: RDS" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> RDS </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>