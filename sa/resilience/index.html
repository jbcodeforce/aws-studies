<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>Resilience - AWS Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#resilience class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AWS Studies" class="md-header__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AWS Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Resilience </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/aws-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AWS Studies" class="md-nav__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> AWS Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/aws-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Infrastructure <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Infrastructure data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../infra/ class=md-nav__link> EC2-others </a> </li> <li class=md-nav__item> <a href=../../infra/networking/ class=md-nav__link> Network </a> </li> <li class=md-nav__item> <a href=../../infra/security/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../../infra/storage/ class=md-nav__link> S3-Storage </a> </li> <li class=md-nav__item> <a href=../../infra/route53/ class=md-nav__link> Route 53 </a> </li> <li class=md-nav__item> <a href=../../monitoring/monitoring/ class=md-nav__link> Monitoring </a> </li> <li class=md-nav__item> <a href=../../infra/messaging/ class=md-nav__link> Messaging </a> </li> <li class=md-nav__item> <a href=../../kinesis/ class=md-nav__link> Kinesis* </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Architecture <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Architecture data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../well-architectured/ class=md-nav__link> Well Architectured </a> </li> <li class=md-nav__item> <a href=../sol-design/ class=md-nav__link> Solution design </a> </li> <li class=md-nav__item> <a href=../psa-role/ class=md-nav__link> SA </a> </li> <li class=md-nav__item> <a href=../saas/ class=md-nav__link> SaaS </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Resilience <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Resilience </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#fault-isolation-concepts class=md-nav__link> Fault isolation concepts </a> </li> <li class=md-nav__item> <a href=#region-az class=md-nav__link> Region, AZ </a> </li> <li class=md-nav__item> <a href=#aws-partitions class=md-nav__link> AWS Partitions </a> </li> <li class=md-nav__item> <a href=#cell-based-architecture-and-shuffle-sharding class=md-nav__link> Cell-based architecture and shuffle sharding </a> </li> <li class=md-nav__item> <a href=#high-availability class=md-nav__link> High Availability </a> <nav class=md-nav aria-label="High Availability"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#measuring-availability class=md-nav__link> Measuring availability </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#latency class=md-nav__link> Latency </a> </li> <li class=md-nav__item> <a href=#multi-az-patterns-az-gray-failure class=md-nav__link> Multi-AZ patterns: AZ gray failure </a> </li> <li class=md-nav__item> <a href=#disaster-recovery class=md-nav__link> Disaster recovery </a> <nav class=md-nav aria-label="Disaster recovery"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#data-migration-service class=md-nav__link> Data Migration Service </a> </li> <li class=md-nav__item> <a href=#replication-to-aurora class=md-nav__link> Replication to Aurora </a> </li> <li class=md-nav__item> <a href=#aws-backup class=md-nav__link> AWS Backup </a> </li> <li class=md-nav__item> <a href=#application-discovery-service class=md-nav__link> Application Discovery Service </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#resilience-patterns class=md-nav__link> Resilience Patterns </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../templ/ class=md-nav__link> Conduct Design session </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../analytics/ class=md-nav__link> Analytics </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Data <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Data data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/ class=md-nav__link> RDS-Aurora-ES </a> </li> <li class=md-nav__item> <a href=../../data/dynamodb/ class=md-nav__link> DynamoDB </a> </li> <li class=md-nav__item> <a href=../../data/data-lake/ class=md-nav__link> Data Lake </a> </li> <li class=md-nav__item> <a href=../../data/redshift/ class=md-nav__link> RedShift </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../ai-ml/ class=md-nav__link> AI-ML </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Serverless <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Serverless data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Serverless </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serverless/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../serverless/lambda/ class=md-nav__link> Lambda </a> </li> <li class=md-nav__item> <a href=../../serverless/apigtw/ class=md-nav__link> API Gateway </a> </li> <li class=md-nav__item> <a href=../../serverless/eks/ class=md-nav__link> EKS </a> </li> <li class=md-nav__item> <a href=../../serverless/eventbridge/ class=md-nav__link> EventBridge </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Playground <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Playground data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Playground </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../playground/gettingstarted/ class=md-nav__link> Getting Started IAM-EC2 </a> </li> <li class=md-nav__item> <a href=../../playground/rds/ class=md-nav__link> RDS </a> </li> <li class=md-nav__item> <a href=../../playground/rt-data-processing/ class=md-nav__link> Data processing </a> </li> <li class=md-nav__item> <a href=../../playground/spark-emr/ class=md-nav__link> Analytics on EMR </a> </li> <li class=md-nav__item> <a href=../../playground/ecs/ class=md-nav__link> ECS </a> </li> <li class=md-nav__item> <a href=../../playground/s3-org-billing/ class=md-nav__link> S3 storage lens </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/big-data-tenant-analytics/ class=md-nav__link> SaaS demo </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Coding <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Coding data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../coding/ class=md-nav__link> Practices </a> </li> <li class=md-nav__item> <a href=../../coding/cloudFormation/ class=md-nav__link> CloudFormation </a> </li> <li class=md-nav__item> <a href=../../coding/cdk/ class=md-nav__link> CDK </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> Return to main </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#fault-isolation-concepts class=md-nav__link> Fault isolation concepts </a> </li> <li class=md-nav__item> <a href=#region-az class=md-nav__link> Region, AZ </a> </li> <li class=md-nav__item> <a href=#aws-partitions class=md-nav__link> AWS Partitions </a> </li> <li class=md-nav__item> <a href=#cell-based-architecture-and-shuffle-sharding class=md-nav__link> Cell-based architecture and shuffle sharding </a> </li> <li class=md-nav__item> <a href=#high-availability class=md-nav__link> High Availability </a> <nav class=md-nav aria-label="High Availability"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#measuring-availability class=md-nav__link> Measuring availability </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#latency class=md-nav__link> Latency </a> </li> <li class=md-nav__item> <a href=#multi-az-patterns-az-gray-failure class=md-nav__link> Multi-AZ patterns: AZ gray failure </a> </li> <li class=md-nav__item> <a href=#disaster-recovery class=md-nav__link> Disaster recovery </a> <nav class=md-nav aria-label="Disaster recovery"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#data-migration-service class=md-nav__link> Data Migration Service </a> </li> <li class=md-nav__item> <a href=#replication-to-aurora class=md-nav__link> Replication to Aurora </a> </li> <li class=md-nav__item> <a href=#aws-backup class=md-nav__link> AWS Backup </a> </li> <li class=md-nav__item> <a href=#application-discovery-service class=md-nav__link> Application Discovery Service </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#resilience-patterns class=md-nav__link> Resilience Patterns </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/jbcodeforce/aws-studies.git/edit/master/docs/sa/resilience.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=resilience>Resilience<a class=headerlink href=#resilience title="Permanent link">&para;</a></h1> <p>Resiliency is the ability of a workload to recover from infrastructure or service disruptions, dynamically acquire computing resources to meet demand, and mitigate disruptions, such as misconfigurations or transient network issues.</p> <p>Apply the sharing responsibility of resiliency. </p> <h2 id=fault-isolation-concepts>Fault isolation concepts<a class=headerlink href=#fault-isolation-concepts title="Permanent link">&para;</a></h2> <ul> <li>Control plane is a complex orchestration with many dependencies so are more difficult to make them resilient. But the lower level of APIs makes it less risky. Still they will fail more often. Latency is not a strong requirement, 100s ms. </li> <li>Do not rely on Auto Scaling Group for EC2 in case of AZ failure, but plan for overcapacity to support the load after AZ failure.</li> <li> <p>Examples of control plan and data plane</p> <table> <thead> <tr> <th>Service</th> <th>Control plane</th> <th>Data plane</th> </tr> </thead> <tbody> <tr> <td>Amazon S3</td> <td>create bucket, put bucket policy</td> <td>GetObject, PutObject</td> </tr> <tr> <td>DynamoDB</td> <td>Create table, update table</td> <td>GetItem ...</td> </tr> <tr> <td>ELB</td> <td>CreateLoadBalancer, CreateTargetGroup</td> <td>The load balancer itself</td> </tr> <tr> <td>Route 53</td> <td>CreateHostedZone ...</td> <td>DNS resolution, health checks</td> </tr> <tr> <td>IAM</td> <td>CreateRole</td> <td>Authn, Authz</td> </tr> <tr> <td>RDS</td> <td>Create DB instance</td> <td>The data base</td> </tr> </tbody> </table> </li> <li> <p>Static stability: system still running even dependencies fail without the need to make changes. Use the following approaches: prevent circular dependencies, pre-provision capacity, maintain existing state, eliminate synchronous interaction.</p> </li> <li>One way AWS achieve static statbility is by removing control plane deplendencis from the data plane in AWS services. </li> <li>Relying on data plane operaions for recovery can help make your system more staticall stable, this may include pre-provisioning resources, or relying on data plane operations.</li> </ul> <h2 id=region-az>Region, AZ<a class=headerlink href=#region-az title="Permanent link">&para;</a></h2> <ul> <li>Non-AZ affinity: a write operation can cross AZs and with data replications it can make a lot of hops </li> <li>AZ-affinity helps to reduce the number of hops, but it enforces using NLB and not ALB.</li> </ul> <h2 id=aws-partitions>AWS Partitions<a class=headerlink href=#aws-partitions title="Permanent link">&para;</a></h2> <p>There are Isolated infrastructure and services. There are commercial partition, China , and GovCloud partition. Within a partition there are regions. Not cross IAM definition sharing. </p> <table> <thead> <tr> <th>Type</th> <th>Service</th> <th>Planes</th> </tr> </thead> <tbody> <tr> <td>Zonal</td> <td>RDS, EC2, EBS</td> <td>Control plane is regional while data plane is zonal</td> </tr> <tr> <td>Regional</td> <td>S3, SQS, DynamoDB</td> <td>Control plane and data plane are regional</td> </tr> <tr> <td>Global</td> <td>CloudFront, Global accelerator, Route 53, IAM</td> <td>Control plane is single region and data plane is global</td> </tr> </tbody> </table> <p>There are three categories of global services: partitional, Edge and globally-scoped operations. Global services havd a single control plane and a distributed, highly available data plane. Avoid control plane dependencies in global services in your recovery path, implement static stability.</p> <h2 id=cell-based-architecture-and-shuffle-sharding>Cell-based architecture and shuffle sharding<a class=headerlink href=#cell-based-architecture-and-shuffle-sharding title="Permanent link">&para;</a></h2> <p>Goal is to reduce the blast-radius. Use the concept of <code>Cell</code> which is a construct to isolate compute, routing, and storage (workload). Cells are not AZs but cross AZs. Cell shares nothing with each other. Cell can scale-up and out. Cell have a maximum size.</p> <p>It is not fitting for all type of workloads. </p> <p>API Gateway uses this Cell-based architecture.</p> <p>Some e-commerce fullfilment delivery centers use cell-based architecture. </p> <p>Considerations to address:</p> <ul> <li>Cell size</li> <li>Router robustness</li> <li>Partitioning dimension</li> <li>Cross-cell use cases</li> <li>Cell migration</li> <li>Alignment to AZs and Regions</li> </ul> <p>Shards is another construct to isolate blast radius, but now at the level of resources. Any serverless services is using the concept of shuffle sharding. </p> <h2 id=high-availability>High Availability<a class=headerlink href=#high-availability title="Permanent link">&para;</a></h2> <p>Availability = uptime / (uptime + downtime)</p> <p>Availability = a1 * a2 *.... * an . It cannot be better than it's least available dependency.</p> <p>Spare components improves availability.</p> <h3 id=measuring-availability>Measuring availability<a class=headerlink href=#measuring-availability title="Permanent link">&para;</a></h3> <p>Metrics to consider:</p> <ul> <li>Mean time between failure MTBF, try to increase it</li> <li>Mean time to detection MTTD</li> <li> <p>Mean time to repair MTTR</p> </li> <li> <p>consider server-side and client-side request success rate. Define what unit of work to be used: HTTP request, message in queue, async job.</p> </li> <li>define downtime, for example, drop below 95% availabiltiy for any API during a 5 minutes window. </li> </ul> <p><strong>Use CW embedded metric format EMF to combine logs and metrics</strong></p> <h2 id=latency>Latency<a class=headerlink href=#latency title="Permanent link">&para;</a></h2> <p>Latency impacts availability. Analyze histograms for latency distribution trends. Use percentiles and trimmed man to measure latency.</p> <h2 id=multi-az-patterns-az-gray-failure>Multi-AZ patterns: AZ gray failure<a class=headerlink href=#multi-az-patterns-az-gray-failure title="Permanent link">&para;</a></h2> <ul> <li>System follows differential observability. </li> <li>Different perspective: system versus application</li> </ul> <p>Detection tools:</p> <ul> <li>cloudwatch contributor insights. </li> </ul> <h2 id=disaster-recovery>Disaster recovery<a class=headerlink href=#disaster-recovery title="Permanent link">&para;</a></h2> <p><a href=https://jbcodeforce.github.io/architecture/DR/ >Review the core principles of DR</a> and then the <a href=https://docs.aws.amazon.com/whitepapers/latest/disaster-recovery-workloads-on-aws/disaster-recovery-options-in-the-cloud.html>AWS options whitepaper</a>.</p> <h3 id=data-migration-service><a href=https://docs.aws.amazon.com/dms/latest/userguide/Welcome.html>Data Migration Service</a><a class=headerlink href=#data-migration-service title="Permanent link">&para;</a></h3> <p>As a managed service, AWS DMS is a server (EC2) in the AWS Cloud that runs replication software, to move data from one database to another running in AWS. Schema transformation can be performed using Schema Conversion Tool (SCT). SCT can run on-premises. </p> <p>Sources can be on-premises DBs, and the targets can still be on-premises DBs but really a lot of AWS data store like RDS, Redshift, DynamoDB, S3, Elasticache, Kinesis data streams, DocumentDB... </p> <p>We can use continuous replication with DMS:</p> <p><img alt src=../diagrams/DR/cont-replication.drawio.png></p> <p>First (1) use the AWS Schema Conversion Tool to convert the source schema and code to match that of the target database, then (2) use the AWS Database Migration Service to migrate data from the source database to the target database.</p> <p>Example of configuration, with EC2 instance type, engine version, allocated storage space for the replication instance, network connectivity...</p> <p><img alt src=../images/DR/dms-1.png></p> <p>Once server is defined, we need to define data provider to specify source and target endpoints and create a migration project to do schema conversion (from Oracle or SQL server to MySQL or PostgreSQL as target). </p> <p>It is possible to leverage AWS Database Migration Service (AWS DMS) as a bridge between Amazon S3 and Amazon Kinesis Data Streams as an easier way to do so: See <a href=https://aws.amazon.com/blogs/big-data/streaming-data-from-amazon-s3-to-amazon-kinesis-data-streams-using-aws-dms/ >Streaming Data from S3 to Kinesis using DMS</a>. AWS DMS allows migration of full and change data capture (CDC) files to these services.</p> <ul> <li><a href=https://aws.amazon.com/dms/faqs/ >DMS FAQ</a></li> </ul> <h3 id=replication-to-aurora>Replication to Aurora<a class=headerlink href=#replication-to-aurora title="Permanent link">&para;</a></h3> <p>For MySQL engine we have different options:</p> <ul> <li>Use RDS DB snapshot from RDS and restore it in Aurora</li> <li>Create an Autora read replica from the RDS MySQL source, when replication lag is 0, we can then promote Aurora as Write and Read.</li> <li>For external MySQL, use XtraBackup to create a file backup, upload it to S3 and import the file into Aurora from S3. Or use <code>mysqldump</code> utility to move to Aurora MySQL DB.</li> <li>Use DMS if both DBs run in parallel</li> </ul> <h3 id=aws-backup><a href=https://docs.aws.amazon.com/aws-backup/latest/devguide/whatisbackup.html>AWS Backup</a><a class=headerlink href=#aws-backup title="Permanent link">&para;</a></h3> <p>Fully-managed service that makes it easy to centralize and automate data protection across AWS services, in the cloud, and on premises. It supports cross-region backups and in multiple AWS accounts across the entire AWS Organization. Src: EC2, EBS, EFS, Amazon FSx for windows, Lustre, and Storage Gateway, RDS, DynamoDB..</p> <p>Target is S3 bucket or Vault Lock.</p> <p>Vault lock is used for Write Once Read Many state. It is to defend on malicious delete as backup cannot be deleted. </p> <p>We can create automated backup schedules and retention policies, lifecycle policies to expire unncecessary backups after a period of time.</p> <p>AWS Backup helps to support the regulatory compliance or business policies for data protection.</p> <h3 id=application-discovery-service><a href=https://docs.aws.amazon.com/application-discovery/latest/userguide/what-is-appdiscovery.html>Application Discovery Service</a><a class=headerlink href=#application-discovery-service title="Permanent link">&para;</a></h3> <p>Managed service to help plan the migration to the AWS cloud by collecting usage and configuration data about the on-premises servers. It is integrated with AWS Migration Hub, which simplifies your migration tracking as it aggregates your migration status information into a single console.</p> <p>It offers two ways of performing discovery: </p> <ul> <li>Agentless: work on VM inventory, configuration, and performance history</li> <li>Agent-based: by deploying AD Agent on each of your VMs and physical servers, it collects static configuration data, detailed time-series system-performance information, inbound and outbound network connections, and processes that are running.</li> </ul> <h2 id=resilience-patterns>Resilience Patterns<a class=headerlink href=#resilience-patterns title="Permanent link">&para;</a></h2> <ul> <li>client side, use circuit braker, retries with jitter, multiplexing connection with new protocol like HTTP/3, gRPC</li> <li>server side, apply caching strategy, cache-aside is more resilient, inline cache, like DynamoDB DAX, may be a single point of failure. </li> </ul> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../saas/ class="md-footer__link md-footer__link--prev" aria-label="Previous: SaaS" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> SaaS </div> </div> </a> <a href=../../templ/ class="md-footer__link md-footer__link--next" aria-label="Next: Conduct Design session" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Conduct Design session </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>