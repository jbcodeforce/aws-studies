<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.1"><title>CDK - AWS Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#cloud-development-kit-cdk class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="AWS Studies" class="md-header__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AWS Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> CDK </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/aws-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="AWS Studies" class="md-nav__button md-logo" aria-label="AWS Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> AWS Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/aws-studies.git title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Infrastructure <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Infrastructure data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../infra/ class=md-nav__link> EC2-others </a> </li> <li class=md-nav__item> <a href=../../infra/networking/ class=md-nav__link> Network </a> </li> <li class=md-nav__item> <a href=../../infra/security/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../../infra/storage/ class=md-nav__link> S3-Storage </a> </li> <li class=md-nav__item> <a href=../../infra/route53/ class=md-nav__link> Route 53 </a> </li> <li class=md-nav__item> <a href=../../monitoring/monitoring/ class=md-nav__link> Monitoring </a> </li> <li class=md-nav__item> <a href=../../infra/messaging/ class=md-nav__link> Messaging </a> </li> <li class=md-nav__item> <a href=../../kinesis/ class=md-nav__link> Kinesis* </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Architecture <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Architecture data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sa/well-architectured/ class=md-nav__link> Well Architectured </a> </li> <li class=md-nav__item> <a href=../../sa/sol-design/ class=md-nav__link> Solution design </a> </li> <li class=md-nav__item> <a href=../../sa/psa-role/ class=md-nav__link> SA </a> </li> <li class=md-nav__item> <a href=../../sa/saas/ class=md-nav__link> SaaS </a> </li> <li class=md-nav__item> <a href=../../sa/resilience/ class=md-nav__link> Resilience </a> </li> <li class=md-nav__item> <a href=../../templ/ class=md-nav__link> Conduct Design session </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../analytics/ class=md-nav__link> Analytics </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Data <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Data data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data/ class=md-nav__link> RDS-Aurora-ES </a> </li> <li class=md-nav__item> <a href=../../data/dynamodb/ class=md-nav__link> DynamoDB </a> </li> <li class=md-nav__item> <a href=../../data/data-lake/ class=md-nav__link> Data Lake </a> </li> <li class=md-nav__item> <a href=../../data/redshift/ class=md-nav__link> RedShift </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../ai-ml/ class=md-nav__link> AI-ML </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Serverless <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Serverless data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Serverless </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../serverless/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../serverless/lambda/ class=md-nav__link> Lambda </a> </li> <li class=md-nav__item> <a href=../../serverless/apigtw/ class=md-nav__link> API Gateway </a> </li> <li class=md-nav__item> <a href=../../serverless/eks/ class=md-nav__link> EKS </a> </li> <li class=md-nav__item> <a href=../../serverless/eventbridge/ class=md-nav__link> EventBridge </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Playground <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Playground data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Playground </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../playground/gettingstarted/ class=md-nav__link> Getting Started IAM-EC2 </a> </li> <li class=md-nav__item> <a href=../../playground/rds/ class=md-nav__link> RDS </a> </li> <li class=md-nav__item> <a href=../../playground/rt-data-processing/ class=md-nav__link> Data processing </a> </li> <li class=md-nav__item> <a href=../../playground/spark-emr/ class=md-nav__link> Analytics on EMR </a> </li> <li class=md-nav__item> <a href=../../playground/ecs/ class=md-nav__link> ECS </a> </li> <li class=md-nav__item> <a href=../../playground/s3-org-billing/ class=md-nav__link> S3 storage lens </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io/big-data-tenant-analytics/ class=md-nav__link> SaaS demo </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9 checked> <label class=md-nav__link for=__nav_9> Coding <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Coding data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Coding </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> Practices </a> </li> <li class=md-nav__item> <a href=../cloudFormation/ class=md-nav__link> CloudFormation </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> CDK <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> CDK </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#install class=md-nav__link> Install </a> </li> <li class=md-nav__item> <a href=#concepts class=md-nav__link> Concepts </a> </li> <li class=md-nav__item> <a href=#cdk-python-for-an-ec2 class=md-nav__link> CDK Python for an EC2 </a> </li> <li class=md-nav__item> <a href=#useful-commands class=md-nav__link> Useful commands </a> </li> <li class=md-nav__item> <a href=#cdk-blueprint-for-eks class=md-nav__link> CDK Blueprint for EKS </a> </li> <li class=md-nav__item> <a href=#secrets class=md-nav__link> Secrets </a> </li> <li class=md-nav__item> <a href=#some-how-to class=md-nav__link> Some how to </a> </li> <li class=md-nav__item> <a href=#other-tools-samples class=md-nav__link> Other tools - samples </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> Return to main </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#install class=md-nav__link> Install </a> </li> <li class=md-nav__item> <a href=#concepts class=md-nav__link> Concepts </a> </li> <li class=md-nav__item> <a href=#cdk-python-for-an-ec2 class=md-nav__link> CDK Python for an EC2 </a> </li> <li class=md-nav__item> <a href=#useful-commands class=md-nav__link> Useful commands </a> </li> <li class=md-nav__item> <a href=#cdk-blueprint-for-eks class=md-nav__link> CDK Blueprint for EKS </a> </li> <li class=md-nav__item> <a href=#secrets class=md-nav__link> Secrets </a> </li> <li class=md-nav__item> <a href=#some-how-to class=md-nav__link> Some how to </a> </li> <li class=md-nav__item> <a href=#other-tools-samples class=md-nav__link> Other tools - samples </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/jbcodeforce/aws-studies.git/edit/master/docs/coding/cdk.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=cloud-development-kit-cdk><a href=https://docs.aws.amazon.com/cdk/v2/guide/home.html>Cloud Development Kit - CDK</a><a class=headerlink href=#cloud-development-kit-cdk title="Permanent link">&para;</a></h1> <p>The AWS CDK lets you build reliable, scalable, cost-effective applications in the cloud with the considerable expressive power of a programming language (Go, Java, Python, C#, JavaScript, Typescript).</p> <p>Build with high-level constructs that automatically provide sensible, secure defaults for your AWS resources, defining more infrastructure with less code.</p> <p>It uses AWS CloudFormation to perform infrastructure deployments predictably and repeatedly, with rollback on error. The output of an AWS CDK program is an AWS CloudFormation template.</p> <h2 id=install>Install<a class=headerlink href=#install title="Permanent link">&para;</a></h2> <p>The CDK cli is packaged as nodejs app.</p> <div class=highlight><pre><span></span><code>npm install -g aws-cdk 
</code></pre></div> <p>A docker file exists under the <code>labs</code> folder to get an environment with nodes, python 3.9, AWS CLI, CDK CLI...</p> <div class=highlight><pre><span></span><code><span class=c1># build the docker</span>
docker build -t jbcodeforce/aws-python .
<span class=c1># Start the env</span>
./startPythonDocker.sh
<span class=c1># verify installation</span>
aws s3 ls
cdk --version
<span class=c1># In app folder and where the cdk.json file is, do</span>
cdk synth
</code></pre></div> <h2 id=concepts>Concepts<a class=headerlink href=#concepts title="Permanent link">&para;</a></h2> <p>A CDK app defines one or more Stacks (= CloudFormation stack). A Stack includes Constructs. Each construct defines one or more concrete AWS resources. Constructs (and also stacks and apps) are represented as classes (types) in your programming language of choice. You instantiate constructs within a stack to declare them to AWS, and connect them to each other using well-defined interfaces.</p> <p>Here is an example of constructs defined in a python class constructor for a lambda function and an API Gateway</p> <div class=highlight><pre><span></span><code><span class=k>class</span> <span class=nc>MyLambdaStack</span><span class=p>(</span><span class=n>Stack</span><span class=p>):</span>
    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>scope</span><span class=p>:</span> <span class=n>Construct</span><span class=p>,</span> <span class=n>construct_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>scope</span><span class=p>,</span> <span class=n>construct_id</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
        <span class=n>my_lambda</span> <span class=o>=</span> <span class=n>_lambda</span><span class=o>.</span><span class=n>Function</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s1>&#39;HelloHandler&#39;</span><span class=p>,</span>
            <span class=n>runtime</span><span class=o>=</span><span class=n>_lambda</span><span class=o>.</span><span class=n>Runtime</span><span class=o>.</span><span class=n>PYTHON_3_7</span><span class=p>,</span>
            <span class=n>code</span><span class=o>=</span><span class=n>_lambda</span><span class=o>.</span><span class=n>Code</span><span class=o>.</span><span class=n>from_asset</span><span class=p>(</span><span class=s1>&#39;lambda&#39;</span><span class=p>),</span>
            <span class=n>handler</span><span class=o>=</span><span class=s1>&#39;hello.handler&#39;</span><span class=p>,</span>
        <span class=p>)</span>

        <span class=n>apigw</span><span class=o>.</span><span class=n>LambdaRestApi</span><span class=p>(</span>
            <span class=bp>self</span><span class=p>,</span> <span class=s1>&#39;Endpoint&#39;</span><span class=p>,</span>
            <span class=n>handler</span><span class=o>=</span><span class=n>my_lambda</span><span class=p>,</span>
        <span class=p>)</span>
</code></pre></div> <p>The AWS CDK Toolkit is a command line tool for interacting with CDK apps. Need to be in the folder of the <code>cdk.json</code> file.</p> <div class=highlight><pre><span></span><code>cdk --version
<span class=c1># Get the CloudFormation template</span>
cdk ls
</code></pre></div> <p>The AWS CDK is shipped with an extensive library of constructs called the <a href=https://docs.aws.amazon.com/cdk/api/v2/docs/aws-construct-library.html>AWS Construct Library</a>. The construct library is divided into modules, one for each AWS service</p> <p>The first time you deploy an AWS CDK app into an environment (account/region), you’ll need to install a “bootstrap stack”. This stack includes resources that are needed for the toolkit’s operation. It requires dedicated Amazon S3 buckets to store template and assets. </p> <p><img alt src=../images/cdk-toolkit-cf.png></p> <ul> <li>See <a href=https://cdkworkshop.com/ >CDK workshops</a></li> <li><a href=https://docs.aws.amazon.com/cdk/api/v2/python/index.html>CDK for Python API</a></li> </ul> <h2 id=cdk-python-for-an-ec2>CDK Python for an EC2<a class=headerlink href=#cdk-python-for-an-ec2 title="Permanent link">&para;</a></h2> <ul> <li>Summary of the actions to jumpstart a CDK sample app in python</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># Create a python CDK project under a new created folder. The name of the folder defines the name of the app.</span>
<span class=c1># It uses the sample-app template. If template is not specified the stack will have only constructor</span>
cdk init sample-app --language python
<span class=c1># cdk init --language python </span>
<span class=c1># create virtual env</span>
python3 -m venv .venv
<span class=c1># Active the virtual env</span>
<span class=nb>source</span> .venv/bin/activate
<span class=c1># Install dependencies</span>
pip install -r requirements.txt
</code></pre></div> <ul> <li>Then develop the CDK class to define the configuration like a simple EC2:</li> </ul> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>aws_cdk</span> <span class=kn>import</span> <span class=p>(</span>
    <span class=n>Stack</span><span class=p>,</span>
    <span class=n>aws_ec2</span> <span class=k>as</span> <span class=n>ec2</span><span class=p>)</span>

<span class=n>amzn_linux</span> <span class=o>=</span> <span class=n>ec2</span><span class=o>.</span><span class=n>MachineImage</span><span class=o>.</span><span class=n>latest_amazon_linux</span><span class=p>(</span>
    <span class=n>generation</span><span class=o>=</span><span class=n>ec2</span><span class=o>.</span><span class=n>AmazonLinuxGeneration</span><span class=o>.</span><span class=n>AMAZON_LINUX_2</span><span class=p>,</span>
    <span class=n>edition</span><span class=o>=</span><span class=n>ec2</span><span class=o>.</span><span class=n>AmazonLinuxEdition</span><span class=o>.</span><span class=n>STANDARD</span><span class=p>,</span>
    <span class=n>virtualization</span><span class=o>=</span><span class=n>ec2</span><span class=o>.</span><span class=n>AmazonLinuxVirt</span><span class=o>.</span><span class=n>HVM</span><span class=p>,</span>
    <span class=n>storage</span><span class=o>=</span><span class=n>ec2</span><span class=o>.</span><span class=n>AmazonLinuxStorage</span><span class=o>.</span><span class=n>GENERAL_PURPOSE</span>
<span class=p>)</span>
<span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&quot;./user_data/user_data.sh&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
    <span class=n>user_data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>

<span class=k>class</span> <span class=nc>Ec2Stack</span><span class=p>(</span><span class=n>Stack</span><span class=p>):</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>instance</span> <span class=o>=</span> <span class=n>ec2</span><span class=o>.</span><span class=n>Instance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;myHttpdEC2&quot;</span><span class=p>,</span>
                                <span class=n>instance_type</span><span class=o>=</span><span class=n>ec2</span><span class=o>.</span><span class=n>InstanceType</span><span class=p>(</span><span class=s2>&quot;t2.micro&quot;</span><span class=p>),</span>
                                <span class=n>instance_name</span><span class=o>=</span><span class=s2>&quot;mySimpleHTTPserver&quot;</span><span class=p>,</span>
                                <span class=n>machine_image</span><span class=o>=</span><span class=n>amzn_linux</span><span class=p>,</span>
                                <span class=n>user_data</span><span class=o>=</span><span class=n>ec2</span><span class=o>.</span><span class=n>UserData</span><span class=o>.</span><span class=n>custom</span><span class=p>(</span><span class=n>user_data</span><span class=p>),</span>
                                <span class=p>)</span>
</code></pre></div> <p>See more <a href=https://docs.aws.amazon.com/cdk/api/v2/python/aws_cdk.aws_ec2/Instance.html>information on the Instance API</a>.</p> <ul> <li>Run the generation of the CD and then deploy to your account / region</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># Synthesize the Cloud Formation template </span>
cdk synth
<span class=c1># The first time bootstrap the stack - which will create a CF CDKToolkit</span>
cdk bootstrap
<span class=c1># or using account and region</span>
cdk bootstrap aws://4....../us-west-2
<span class=c1># Deploy the stack</span>
cdk deploy
<span class=c1># Update the code and do a partial (hotswappable) deployment</span>
cdk deploy --hotswap
</code></pre></div> <ul> <li>Then go to the CloudFormation console and look at the deployed stack, and resources.</li> </ul> <p>See the <a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/cdk>labs/cdk</a> folder for some examples of CDK stack definitions: </p> <table> <thead> <tr> <th>Folder</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/cdk/ec2-vpc>labs/cdk/ec2-vpc</a></td> <td>EC2 with VPC and public &amp; private subnets, NAT, IGW, Bastion Host</td> </tr> <tr> <td><a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/cdk/cdk_workshop>labs/cdk/cdk_workhop</a></td> <td>Lambda functions in python with an API gateway and TableViewer.</td> </tr> <tr> <td><a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/cdk/ecs-fargate-flask>lab ECS fargate Flask App</a></td> <td>VPC with ECS fargate for a Flask APP where container is created during deployment</td> </tr> <tr> <td><a href=https://github.com/jbcodeforce/aws-studies/tree/main/labs/eks//eks-cdk/ >lab EKS</a></td> <td>VPC with EKS cluster deployment</td> </tr> </tbody> </table> <h2 id=useful-commands>Useful commands<a class=headerlink href=#useful-commands title="Permanent link">&para;</a></h2> <ul> <li><code>cdk ls</code> list all stacks in the app</li> <li><code>cdk synth</code> emits the synthesized CloudFormation template</li> <li><code>cdk deploy</code> deploy this stack to your default AWS account/region</li> <li><code>cdk diff</code> compare deployed stack with current state</li> <li><code>cdk docs</code> open CDK documentation</li> <li><code>cdk watch</code> monitors your code and assets for changes and attempts to perform a deployment automatically when a change is detected</li> <li><code>cdk destroy</code> remove all the resources/stacks. Most resources will get deleted upon stack deletion. CloudWatch logs that are permanently retained</li> </ul> <h2 id=cdk-blueprint-for-eks><a href=https://aws.github.io/aws-eks-best-practices/ >CDK Blueprint for EKS</a><a class=headerlink href=#cdk-blueprint-for-eks title="Permanent link">&para;</a></h2> <ul> <li><a href=https://aws.amazon.com/blogs/containers/bootstrapping-clusters-with-eks-blueprints/ >Blog introduction EKS blueprint</a></li> <li><a href=https://aws-quickstart.github.io/cdk-eks-blueprints/ >AWS CDK EKS blueprint git repo</a></li> </ul> <h2 id=secrets>Secrets<a class=headerlink href=#secrets title="Permanent link">&para;</a></h2> <h2 id=some-how-to>Some how to<a class=headerlink href=#some-how-to title="Permanent link">&para;</a></h2> <details class=-> <summary>Declare RDS postgres with secrets</summary> <p>The following python CDK code declare a Postgresql DB in a private subnet within a VPC created before. The access is public. CDK will create a secret in AWS Secret manager. <div class=highlight><pre><span></span><code> <span class=bp>self</span><span class=o>.</span><span class=n>postgres</span> <span class=o>=</span> <span class=n>aws_rds</span><span class=o>.</span><span class=n>DatabaseInstance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=s2>&quot;PostgresqlInstance&quot;</span><span class=p>,</span>
                            <span class=n>database_name</span><span class=o>=</span><span class=s2>&quot;tenantdb&quot;</span><span class=p>,</span>
                            <span class=n>engine</span><span class=o>=</span><span class=n>aws_rds</span><span class=o>.</span><span class=n>DatabaseInstanceEngine</span><span class=o>.</span><span class=n>postgres</span><span class=p>(</span><span class=n>version</span><span class=o>=</span><span class=n>aws_rds</span><span class=o>.</span><span class=n>PostgresEngineVersion</span><span class=o>.</span><span class=n>VER_14_5</span><span class=p>),</span>
                            <span class=n>vpc_subnets</span><span class=o>=</span><span class=n>aws_ec2</span><span class=o>.</span><span class=n>SubnetSelection</span><span class=p>(</span><span class=n>subnet_type</span><span class=o>=</span><span class=n>aws_ec2</span><span class=o>.</span><span class=n>SubnetType</span><span class=o>.</span><span class=n>PRIVATE_WITH_EGRESS</span><span class=p>),</span>
                            <span class=n>vpc</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>vpc</span><span class=p>,</span>
                            <span class=n>port</span><span class=o>=</span><span class=mi>5432</span><span class=p>,</span>
                            <span class=n>removal_policy</span><span class=o>=</span><span class=n>RemovalPolicy</span><span class=o>.</span><span class=n>DESTROY</span><span class=p>,</span>
                            <span class=n>deletion_protection</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
                            <span class=n>max_allocated_storage</span><span class=o>=</span><span class=mi>200</span><span class=p>,</span>
                            <span class=n>publicly_accessible</span><span class=o>=</span><span class=kc>True</span>
                    <span class=p>)</span>
</code></pre></div></p> </details> <h2 id=other-tools-samples>Other tools - samples<a class=headerlink href=#other-tools-samples title="Permanent link">&para;</a></h2> <ul> <li><a href=https://docs.aws.amazon.com/cdk/api/v2/python/ >CDK API v2 for Python</a></li> <li><a href=https://pypi.org/project/cdk-dynamo-table-view/ >cdk-dynamo-table-viewer</a> An AWS CDK construct which exposes a public HTTP endpoint which displays an HTML page with the contents of a DynamoDB table in your stack.</li> <li><a href=https://github.com/aws-samples/aws-cdk-examples/tree/master/python>AWS CDK samples in Python</a></li> <li><a href=https://constructs.dev/ >Constructs HUB</a></li> <li><a href=https://github.com/jbcodeforce/python-code/tree/master/aws/dynamoDB>A Flask app for orders management with DynamoDB as persistence - ECR - CDK</a></li> <li><a href=https://github.com/jbcodeforce/big-data-tenant-analytics/tree/main/setup>Big Data SaaS demo</a></li> </ul> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../cloudFormation/ class="md-footer__link md-footer__link--prev" aria-label="Previous: CloudFormation" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> CloudFormation </div> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.9c69f0bc.min.js></script> </body> </html>